/*
Copyright (c) 2014, Battelle Memorial Institute
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

The views and conclusions contained in the software and documentation are those
of the authors and should not be interpreted as representing official policies,
either expressed or implied, of the FreeBSD Project.


This material was prepared as an account of work sponsored by an
agency of the United States Government.  Neither the United States
Government nor the United States Department of Energy, nor Battelle,
nor any of their employees, nor any jurisdiction or organization
that has cooperated in the development of these materials, makes
any warranty, express or implied, or assumes any legal liability
or responsibility for the accuracy, completeness, or usefulness or
any information, apparatus, product, software, or process disclosed,
or represents that its use would not infringe privately owned rights.

Reference herein to any specific commercial product, process, or
service by trade name, trademark, manufacturer, or otherwise does
not necessarily constitute or imply its endorsement, recommendation,
or favoring by the United States Government or any agency thereof,
or Battelle Memorial Institute. The views and opinions of authors
expressed herein do not necessarily state or reflect those of the
United States Government or any agency thereof.

PACIFIC NORTHWEST NATIONAL LABORATORY
operated by BATTELLE for the UNITED STATES DEPARTMENT OF ENERGY
under Contract DE-AC05-76RL01830
*/
!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.tv4=b()}(this,function(){function a(a){return encodeURI(a).replace(/%25[0-9][0-9]/g,function(a){return"%"+a.substring(3)})}function b(b){var c="";m[b.charAt(0)]&&(c=b.charAt(0),b=b.substring(1));var d="",e="",f=!0,g=!1,h=!1;"+"===c?f=!1:"."===c?(e=".",d="."):"/"===c?(e="/",d="/"):"#"===c?(e="#",f=!1):";"===c?(e=";",d=";",g=!0,h=!0):"?"===c?(e="?",d="&",g=!0):"&"===c&&(e="&",d="&",g=!0);for(var i=[],j=b.split(","),k=[],l={},o=0;o<j.length;o++){var p=j[o],q=null;if(-1!==p.indexOf(":")){var r=p.split(":");p=r[0],q=parseInt(r[1],10)}for(var s={};n[p.charAt(p.length-1)];)s[p.charAt(p.length-1)]=!0,p=p.substring(0,p.length-1);var t={truncate:q,name:p,suffices:s};k.push(t),l[p]=t,i.push(p)}var u=function(b){for(var c="",i=0,j=0;j<k.length;j++){var l=k[j],m=b(l.name);if(null===m||void 0===m||Array.isArray(m)&&0===m.length||"object"==typeof m&&0===Object.keys(m).length)i++;else if(c+=j===i?e:d||",",Array.isArray(m)){g&&(c+=l.name+"=");for(var n=0;n<m.length;n++)n>0&&(c+=l.suffices["*"]?d||",":",",l.suffices["*"]&&g&&(c+=l.name+"=")),c+=f?encodeURIComponent(m[n]).replace(/!/g,"%21"):a(m[n])}else if("object"==typeof m){g&&!l.suffices["*"]&&(c+=l.name+"=");var o=!0;for(var p in m)o||(c+=l.suffices["*"]?d||",":","),o=!1,c+=f?encodeURIComponent(p).replace(/!/g,"%21"):a(p),c+=l.suffices["*"]?"=":",",c+=f?encodeURIComponent(m[p]).replace(/!/g,"%21"):a(m[p])}else g&&(c+=l.name,h&&""===m||(c+="=")),null!=l.truncate&&(m=m.substring(0,l.truncate)),c+=f?encodeURIComponent(m).replace(/!/g,"%21"):a(m)}return c};return u.varNames=i,{prefix:e,substitution:u}}function c(a){if(!(this instanceof c))return new c(a);for(var d=a.split("{"),e=[d.shift()],f=[],g=[],h=[];d.length>0;){var i=d.shift(),j=i.split("}")[0],k=i.substring(j.length+1),l=b(j);g.push(l.substitution),f.push(l.prefix),e.push(k),h=h.concat(l.substitution.varNames)}this.fill=function(a){for(var b=e[0],c=0;c<g.length;c++){var d=g[c];b+=d(a),b+=e[c+1]}return b},this.varNames=h,this.template=a}function d(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(Array.isArray(a)!==Array.isArray(b))return!1;if(Array.isArray(a)){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!d(a[c],b[c]))return!1}else{var e;for(e in a)if(void 0===b[e]&&void 0!==a[e])return!1;for(e in b)if(void 0===a[e]&&void 0!==b[e])return!1;for(e in a)if(!d(a[e],b[e]))return!1}return!0}return!1}function e(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function f(a,b){function c(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return b=e(b||""),a=e(a||""),b&&a?(b.protocol||a.protocol)+(b.protocol||b.authority?b.authority:a.authority)+c(b.protocol||b.authority||"/"===b.pathname.charAt(0)?b.pathname:b.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+b.pathname:a.pathname)+(b.protocol||b.authority||b.pathname?b.search:b.search||a.search)+b.hash:null}function g(a){return a.split("#")[0]}function h(a,b){if(a&&"object"==typeof a)if(void 0===b?b=a.id:"string"==typeof a.id&&(b=f(b,a.id),a.id=b),Array.isArray(a))for(var c=0;c<a.length;c++)h(a[c],b);else{"string"==typeof a.$ref&&(a.$ref=f(b,a.$ref));for(var d in a)"enum"!==d&&h(a[d],b)}}function i(a){a=a||"en";var b=v[a];return function(a){var c=b[a.code]||u[a.code];if("string"!=typeof c)return"Unknown error code "+a.code+": "+JSON.stringify(a.messageParams);var d=a.params;return c.replace(/\{([^{}]*)\}/g,function(a,b){var c=d[b];return"string"==typeof c||"number"==typeof c?c:a})}}function j(a,b,c,d,e){if(Error.call(this),void 0===a)throw new Error("No error code supplied: "+d);this.message="",this.params=b,this.code=a,this.dataPath=c||"",this.schemaPath=d||"",this.subErrors=e||null;var f=new Error(this.message);if(this.stack=f.stack||f.stacktrace,!this.stack)try{throw f}catch(f){this.stack=f.stack||f.stacktrace}}function k(a,b){if(b.substring(0,a.length)===a){var c=b.substring(a.length);if(b.length>0&&"/"===b.charAt(a.length-1)||"#"===c.charAt(0)||"?"===c.charAt(0))return!0}return!1}function l(a){var b,c,d=new o,e={setErrorReporter:function(a){return"string"==typeof a?this.language(a):(c=a,!0)},addFormat:function(){d.addFormat.apply(d,arguments)},language:function(a){return a?(v[a]||(a=a.split("-")[0]),v[a]?(b=a,a):!1):b},addLanguage:function(a,b){var c;for(c in r)b[c]&&!b[r[c]]&&(b[r[c]]=b[c]);var d=a.split("-")[0];if(v[d]){v[a]=Object.create(v[d]);for(c in b)"undefined"==typeof v[d][c]&&(v[d][c]=b[c]),v[a][c]=b[c]}else v[a]=b,v[d]=b;return this},freshApi:function(a){var b=l();return a&&b.language(a),b},validate:function(a,e,f,g){var h=i(b),j=c?function(a,b,d){return c(a,b,d)||h(a,b,d)}:h,k=new o(d,!1,j,f,g);"string"==typeof e&&(e={$ref:e}),k.addSchema("",e);var l=k.validateAll(a,e,null,null,"");return!l&&g&&(l=k.banUnknownProperties(a,e)),this.error=l,this.missing=k.missing,this.valid=null===l,this.valid},validateResult:function(){var a={};return this.validate.apply(a,arguments),a},validateMultiple:function(a,e,f,g){var h=i(b),j=c?function(a,b,d){return c(a,b,d)||h(a,b,d)}:h,k=new o(d,!0,j,f,g);"string"==typeof e&&(e={$ref:e}),k.addSchema("",e),k.validateAll(a,e,null,null,""),g&&k.banUnknownProperties(a,e);var l={};return l.errors=k.errors,l.missing=k.missing,l.valid=0===l.errors.length,l},addSchema:function(){return d.addSchema.apply(d,arguments)},getSchema:function(){return d.getSchema.apply(d,arguments)},getSchemaMap:function(){return d.getSchemaMap.apply(d,arguments)},getSchemaUris:function(){return d.getSchemaUris.apply(d,arguments)},getMissingUris:function(){return d.getMissingUris.apply(d,arguments)},dropSchemas:function(){d.dropSchemas.apply(d,arguments)},defineKeyword:function(){d.defineKeyword.apply(d,arguments)},defineError:function(a,b,c){if("string"!=typeof a||!/^[A-Z]+(_[A-Z]+)*$/.test(a))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof b||b%1!==0||1e4>b)throw new Error("Code number must be an integer > 10000");if("undefined"!=typeof r[a])throw new Error("Error already defined: "+a+" as "+r[a]);if("undefined"!=typeof s[b])throw new Error("Error code already used: "+s[b]+" as "+b);r[a]=b,s[b]=a,u[a]=u[b]=c;for(var d in v){var e=v[d];e[a]&&(e[b]=e[b]||e[a])}},reset:function(){d.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:h,resolveUrl:f,getDocumentUri:g,errorCodes:r};return e.language(a||"en"),e}Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Object.isFrozen||(Object.isFrozen=function(a){for(var b="tv4_test_frozen_key";a.hasOwnProperty(b);)b+=Math.random();try{return a[b]=!0,delete a[b],!1}catch(c){return!0}});var m={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},n={"*":!0};c.prototype={toString:function(){return this.template},fillFromObject:function(a){return this.fill(function(b){return a[b]})}};var o=function(a,b,c,d,e){if(this.missing=[],this.missingMap={},this.formatValidators=a?Object.create(a.formatValidators):{},this.schemas=a?Object.create(a.schemas):{},this.collectMultiple=b,this.errors=[],this.handleError=b?this.collectError:this.returnError,d&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),e&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=c||i("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},a)for(var f in a.definedKeywords)this.definedKeywords[f]=a.definedKeywords[f].slice(0)};o.prototype.defineKeyword=function(a,b){this.definedKeywords[a]=this.definedKeywords[a]||[],this.definedKeywords[a].push(b)},o.prototype.createError=function(a,b,c,d,e,f,g){var h=new j(a,b,c,d,e);return h.message=this.errorReporter(h,f,g),h},o.prototype.returnError=function(a){return a},o.prototype.collectError=function(a){return a&&this.errors.push(a),null},o.prototype.prefixErrors=function(a,b,c){for(var d=a;d<this.errors.length;d++)this.errors[d]=this.errors[d].prefixWith(b,c);return this},o.prototype.banUnknownProperties=function(a,b){for(var c in this.unknownPropertyPaths){var d=this.createError(r.UNKNOWN_PROPERTY,{path:c},c,"",null,a,b),e=this.handleError(d);if(e)return e}return null},o.prototype.addFormat=function(a,b){if("object"==typeof a){for(var c in a)this.addFormat(c,a[c]);return this}this.formatValidators[a]=b},o.prototype.resolveRefs=function(a,b){if(void 0!==a.$ref){if(b=b||{},b[a.$ref])return this.createError(r.CIRCULAR_REFERENCE,{urls:Object.keys(b).join(", ")},"","",null,void 0,a);b[a.$ref]=!0,a=this.getSchema(a.$ref,b)}return a},o.prototype.getSchema=function(a,b){var c;if(void 0!==this.schemas[a])return c=this.schemas[a],this.resolveRefs(c,b);var d=a,e="";if(-1!==a.indexOf("#")&&(e=a.substring(a.indexOf("#")+1),d=a.substring(0,a.indexOf("#"))),"object"==typeof this.schemas[d]){c=this.schemas[d];var f=decodeURIComponent(e);if(""===f)return this.resolveRefs(c,b);if("/"!==f.charAt(0))return void 0;for(var g=f.split("/").slice(1),h=0;h<g.length;h++){var i=g[h].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===c[i]){c=void 0;break}c=c[i]}if(void 0!==c)return this.resolveRefs(c,b)}void 0===this.missing[d]&&(this.missing.push(d),this.missing[d]=d,this.missingMap[d]=d)},o.prototype.searchSchemas=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this.searchSchemas(a[c],b);else if(a&&"object"==typeof a){"string"==typeof a.id&&k(b,a.id)&&void 0===this.schemas[a.id]&&(this.schemas[a.id]=a);for(var d in a)if("enum"!==d)if("object"==typeof a[d])this.searchSchemas(a[d],b);else if("$ref"===d){var e=g(a[d]);e&&void 0===this.schemas[e]&&void 0===this.missingMap[e]&&(this.missingMap[e]=e)}}},o.prototype.addSchema=function(a,b){if("string"!=typeof a||"undefined"==typeof b){if("object"!=typeof a||"string"!=typeof a.id)return;b=a,a=b.id}a===g(a)+"#"&&(a=g(a)),this.schemas[a]=b,delete this.missingMap[a],h(b,a),this.searchSchemas(b,a)},o.prototype.getSchemaMap=function(){var a={};for(var b in this.schemas)a[b]=this.schemas[b];return a},o.prototype.getSchemaUris=function(a){var b=[];for(var c in this.schemas)(!a||a.test(c))&&b.push(c);return b},o.prototype.getMissingUris=function(a){var b=[];for(var c in this.missingMap)(!a||a.test(c))&&b.push(c);return b},o.prototype.dropSchemas=function(){this.schemas={},this.reset()},o.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},o.prototype.validateAll=function(a,b,c,d,e){var f;if(b=this.resolveRefs(b),!b)return null;if(b instanceof j)return this.errors.push(b),b;var g,h=this.errors.length,i=null,k=null;if(this.checkRecursive&&a&&"object"==typeof a){if(f=!this.scanned.length,a[this.validatedSchemasKey]){var l=a[this.validatedSchemasKey].indexOf(b);if(-1!==l)return this.errors=this.errors.concat(a[this.validationErrorsKey][l]),null}if(Object.isFrozen(a)&&(g=this.scannedFrozen.indexOf(a),-1!==g)){var m=this.scannedFrozenSchemas[g].indexOf(b);if(-1!==m)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[g][m]),null}if(this.scanned.push(a),Object.isFrozen(a))-1===g&&(g=this.scannedFrozen.length,this.scannedFrozen.push(a),this.scannedFrozenSchemas.push([])),i=this.scannedFrozenSchemas[g].length,this.scannedFrozenSchemas[g][i]=b,this.scannedFrozenValidationErrors[g][i]=[];else{if(!a[this.validatedSchemasKey])try{Object.defineProperty(a,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(a,this.validationErrorsKey,{value:[],configurable:!0})}catch(n){a[this.validatedSchemasKey]=[],a[this.validationErrorsKey]=[]}k=a[this.validatedSchemasKey].length,a[this.validatedSchemasKey][k]=b,a[this.validationErrorsKey][k]=[]}}var o=this.errors.length,p=this.validateBasic(a,b,e)||this.validateNumeric(a,b,e)||this.validateString(a,b,e)||this.validateArray(a,b,e)||this.validateObject(a,b,e)||this.validateCombinations(a,b,e)||this.validateHypermedia(a,b,e)||this.validateFormat(a,b,e)||this.validateDefinedKeywords(a,b,e)||null;if(f){for(;this.scanned.length;){var q=this.scanned.pop();delete q[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(p||o!==this.errors.length)for(;c&&c.length||d&&d.length;){var r=c&&c.length?""+c.pop():null,s=d&&d.length?""+d.pop():null;p&&(p=p.prefixWith(r,s)),this.prefixErrors(o,r,s)}return null!==i?this.scannedFrozenValidationErrors[g][i]=this.errors.slice(h):null!==k&&(a[this.validationErrorsKey][k]=this.errors.slice(h)),this.handleError(p)},o.prototype.validateFormat=function(a,b){if("string"!=typeof b.format||!this.formatValidators[b.format])return null;var c=this.formatValidators[b.format].call(null,a,b);return"string"==typeof c||"number"==typeof c?this.createError(r.FORMAT_CUSTOM,{message:c},"","/format",null,a,b):c&&"object"==typeof c?this.createError(r.FORMAT_CUSTOM,{message:c.message||"?"},c.dataPath||"",c.schemaPath||"/format",null,a,b):null},o.prototype.validateDefinedKeywords=function(a,b,c){for(var d in this.definedKeywords)if("undefined"!=typeof b[d])for(var e=this.definedKeywords[d],f=0;f<e.length;f++){var g=e[f],h=g(a,b[d],b,c);if("string"==typeof h||"number"==typeof h)return this.createError(r.KEYWORD_CUSTOM,{key:d,message:h},"","",null,a,b).prefixWith(null,d);if(h&&"object"==typeof h){var i=h.code;if("string"==typeof i){if(!r[i])throw new Error("Undefined error code (use defineError): "+i);i=r[i]}else"number"!=typeof i&&(i=r.KEYWORD_CUSTOM);var j="object"==typeof h.message?h.message:{key:d,message:h.message||"?"},k=h.schemaPath||"/"+d.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(i,j,h.dataPath||null,k,null,a,b)}}return null},o.prototype.validateBasic=function(a,b,c){var d;return(d=this.validateType(a,b,c))?d.prefixWith(null,"type"):(d=this.validateEnum(a,b,c))?d.prefixWith(null,"type"):null},o.prototype.validateType=function(a,b){if(void 0===b.type)return null;var c=typeof a;null===a?c="null":Array.isArray(a)&&(c="array");var d=b.type;"object"!=typeof d&&(d=[d]);for(var e=0;e<d.length;e++){var f=d[e];if(f===c||"integer"===f&&"number"===c&&a%1===0)return null}return this.createError(r.INVALID_TYPE,{type:c,expected:d.join("/")},"","",null,a,b)},o.prototype.validateEnum=function(a,b){if(void 0===b["enum"])return null;for(var c=0;c<b["enum"].length;c++){var e=b["enum"][c];if(d(a,e))return null}return this.createError(r.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(a):a},"","",null,a,b)},o.prototype.validateNumeric=function(a,b,c){return this.validateMultipleOf(a,b,c)||this.validateMinMax(a,b,c)||this.validateNaN(a,b,c)||null};var p=Math.pow(2,-51),q=1-p;o.prototype.validateMultipleOf=function(a,b){var c=b.multipleOf||b.divisibleBy;if(void 0===c)return null;if("number"==typeof a){var d=a/c%1;if(d>=p&&q>d)return this.createError(r.NUMBER_MULTIPLE_OF,{value:a,multipleOf:c},"","",null,a,b)}return null},o.prototype.validateMinMax=function(a,b){if("number"!=typeof a)return null;if(void 0!==b.minimum){if(a<b.minimum)return this.createError(r.NUMBER_MINIMUM,{value:a,minimum:b.minimum},"","/minimum",null,a,b);if(b.exclusiveMinimum&&a===b.minimum)return this.createError(r.NUMBER_MINIMUM_EXCLUSIVE,{value:a,minimum:b.minimum},"","/exclusiveMinimum",null,a,b)}if(void 0!==b.maximum){if(a>b.maximum)return this.createError(r.NUMBER_MAXIMUM,{value:a,maximum:b.maximum},"","/maximum",null,a,b);if(b.exclusiveMaximum&&a===b.maximum)return this.createError(r.NUMBER_MAXIMUM_EXCLUSIVE,{value:a,maximum:b.maximum},"","/exclusiveMaximum",null,a,b)}return null},o.prototype.validateNaN=function(a,b){return"number"!=typeof a?null:isNaN(a)===!0||a===1/0||a===-(1/0)?this.createError(r.NUMBER_NOT_A_NUMBER,{value:a},"","/type",null,a,b):null},o.prototype.validateString=function(a,b,c){return this.validateStringLength(a,b,c)||this.validateStringPattern(a,b,c)||null},o.prototype.validateStringLength=function(a,b){return"string"!=typeof a?null:void 0!==b.minLength&&a.length<b.minLength?this.createError(r.STRING_LENGTH_SHORT,{length:a.length,minimum:b.minLength},"","/minLength",null,a,b):void 0!==b.maxLength&&a.length>b.maxLength?this.createError(r.STRING_LENGTH_LONG,{length:a.length,maximum:b.maxLength},"","/maxLength",null,a,b):null},o.prototype.validateStringPattern=function(a,b){if("string"!=typeof a||"string"!=typeof b.pattern&&!(b.pattern instanceof RegExp))return null;var c;if(b.pattern instanceof RegExp)c=b.pattern;else{var d,e="",f=b.pattern.match(/^\/(.+)\/([img]*)$/);f?(d=f[1],e=f[2]):d=b.pattern,c=new RegExp(d,e)}return c.test(a)?null:this.createError(r.STRING_PATTERN,{pattern:b.pattern},"","/pattern",null,a,b)},o.prototype.validateArray=function(a,b,c){return Array.isArray(a)?this.validateArrayLength(a,b,c)||this.validateArrayUniqueItems(a,b,c)||this.validateArrayItems(a,b,c)||null:null},o.prototype.validateArrayLength=function(a,b){var c;return void 0!==b.minItems&&a.length<b.minItems&&(c=this.createError(r.ARRAY_LENGTH_SHORT,{length:a.length,minimum:b.minItems},"","/minItems",null,a,b),this.handleError(c))?c:void 0!==b.maxItems&&a.length>b.maxItems&&(c=this.createError(r.ARRAY_LENGTH_LONG,{length:a.length,maximum:b.maxItems},"","/maxItems",null,a,b),this.handleError(c))?c:null},o.prototype.validateArrayUniqueItems=function(a,b){if(b.uniqueItems)for(var c=0;c<a.length;c++)for(var e=c+1;e<a.length;e++)if(d(a[c],a[e])){var f=this.createError(r.ARRAY_UNIQUE,{match1:c,match2:e},"","/uniqueItems",null,a,b);if(this.handleError(f))return f}return null},o.prototype.validateArrayItems=function(a,b,c){if(void 0===b.items)return null;var d,e;if(Array.isArray(b.items)){for(e=0;e<a.length;e++)if(e<b.items.length){if(d=this.validateAll(a[e],b.items[e],[e],["items",e],c+"/"+e))return d}else if(void 0!==b.additionalItems)if("boolean"==typeof b.additionalItems){if(!b.additionalItems&&(d=this.createError(r.ARRAY_ADDITIONAL_ITEMS,{},"/"+e,"/additionalItems",null,a,b),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalItems,[e],["additionalItems"],c+"/"+e))return d}else for(e=0;e<a.length;e++)if(d=this.validateAll(a[e],b.items,[e],["items"],c+"/"+e))return d;return null},o.prototype.validateObject=function(a,b,c){return"object"!=typeof a||null===a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,b,c)||this.validateObjectRequiredProperties(a,b,c)||this.validateObjectProperties(a,b,c)||this.validateObjectDependencies(a,b,c)||null},o.prototype.validateObjectMinMaxProperties=function(a,b){var c,d=Object.keys(a);return void 0!==b.minProperties&&d.length<b.minProperties&&(c=this.createError(r.OBJECT_PROPERTIES_MINIMUM,{propertyCount:d.length,minimum:b.minProperties},"","/minProperties",null,a,b),this.handleError(c))?c:void 0!==b.maxProperties&&d.length>b.maxProperties&&(c=this.createError(r.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:d.length,maximum:b.maxProperties},"","/maxProperties",null,a,b),this.handleError(c))?c:null},o.prototype.validateObjectRequiredProperties=function(a,b){if(void 0!==b.required)for(var c=0;c<b.required.length;c++){var d=b.required[c];if(void 0===a[d]){var e=this.createError(r.OBJECT_REQUIRED,{key:d},"","/required/"+c,null,a,b);if(this.handleError(e))return e}}return null},o.prototype.validateObjectProperties=function(a,b,c){var d;for(var e in a){var f=c+"/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),g=!1;if(void 0!==b.properties&&void 0!==b.properties[e]&&(g=!0,d=this.validateAll(a[e],b.properties[e],[e],["properties",e],f)))return d;if(void 0!==b.patternProperties)for(var h in b.patternProperties){var i=new RegExp(h);if(i.test(e)&&(g=!0,d=this.validateAll(a[e],b.patternProperties[h],[e],["patternProperties",h],f)))return d}if(g)this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]);else if(void 0!==b.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]),"boolean"==typeof b.additionalProperties){if(!b.additionalProperties&&(d=this.createError(r.OBJECT_ADDITIONAL_PROPERTIES,{},"","/additionalProperties",null,a,b),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalProperties,[e],["additionalProperties"],f))return d}else this.trackUnknownProperties&&!this.knownPropertyPaths[f]&&(this.unknownPropertyPaths[f]=!0)}return null},o.prototype.validateObjectDependencies=function(a,b,c){var d;if(void 0!==b.dependencies)for(var e in b.dependencies)if(void 0!==a[e]){var f=b.dependencies[e];if("string"==typeof f){if(void 0===a[f]&&(d=this.createError(r.OBJECT_DEPENDENCY_KEY,{key:e,missing:f},"","",null,a,b).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];if(void 0===a[h]&&(d=this.createError(r.OBJECT_DEPENDENCY_KEY,{key:e,missing:h},"","/"+g,null,a,b).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(d=this.validateAll(a,f,[],["dependencies",e],c))return d}return null},o.prototype.validateCombinations=function(a,b,c){return this.validateAllOf(a,b,c)||this.validateAnyOf(a,b,c)||this.validateOneOf(a,b,c)||this.validateNot(a,b,c)||null},o.prototype.validateAllOf=function(a,b,c){if(void 0===b.allOf)return null;for(var d,e=0;e<b.allOf.length;e++){var f=b.allOf[e];if(d=this.validateAll(a,f,[],["allOf",e],c))return d}return null},o.prototype.validateAnyOf=function(a,b,c){if(void 0===b.anyOf)return null;var d,e,f=[],g=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var h=!0,i=0;i<b.anyOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var j=b.anyOf[i],k=this.errors.length,l=this.validateAll(a,j,[],["anyOf",i],c);if(null===l&&k===this.errors.length){if(this.errors=this.errors.slice(0,g),this.trackUnknownProperties){for(var m in this.knownPropertyPaths)e[m]=!0,delete d[m];for(var n in this.unknownPropertyPaths)e[n]||(d[n]=!0);h=!1;continue}return null}l&&f.push(l.prefixWith(null,""+i).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),h?(f=f.concat(this.errors.slice(g)),this.errors=this.errors.slice(0,g),this.createError(r.ANY_OF_MISSING,{},"","/anyOf",f,a,b)):void 0},o.prototype.validateOneOf=function(a,b,c){if(void 0===b.oneOf)return null;var d,e,f=null,g=[],h=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var i=0;i<b.oneOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var j=b.oneOf[i],k=this.errors.length,l=this.validateAll(a,j,[],["oneOf",i],c);if(null===l&&k===this.errors.length){if(null!==f)return this.errors=this.errors.slice(0,h),this.createError(r.ONE_OF_MULTIPLE,{index1:f,index2:i},"","/oneOf",null,a,b);if(f=i,this.trackUnknownProperties){for(var m in this.knownPropertyPaths)e[m]=!0,delete d[m];for(var n in this.unknownPropertyPaths)e[n]||(d[n]=!0)}}else l&&g.push(l)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===f?(g=g.concat(this.errors.slice(h)),this.errors=this.errors.slice(0,h),this.createError(r.ONE_OF_MISSING,{},"","/oneOf",g,a,b)):(this.errors=this.errors.slice(0,h),null)},o.prototype.validateNot=function(a,b,c){if(void 0===b.not)return null;var d,e,f=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var g=this.validateAll(a,b.not,null,null,c),h=this.errors.slice(f);return this.errors=this.errors.slice(0,f),this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===g&&0===h.length?this.createError(r.NOT_PASSED,{},"","/not",null,a,b):null},o.prototype.validateHypermedia=function(a,b,d){if(!b.links)return null;for(var e,f=0;f<b.links.length;f++){var g=b.links[f];if("describedby"===g.rel){for(var h=new c(g.href),i=!0,j=0;j<h.varNames.length;j++)if(!(h.varNames[j]in a)){i=!1;break}if(i){var k=h.fillFromObject(a),l={$ref:k};if(e=this.validateAll(a,l,[],["links",f],d))return e}}}};var r={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},s={};for(var t in r)s[r[t]]=t;var u={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};j.prototype=Object.create(Error.prototype),j.prototype.constructor=j,j.prototype.name="ValidationError",j.prototype.prefixWith=function(a,b){if(null!==a&&(a=a.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+a+this.dataPath),null!==b&&(b=b.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+b+this.schemaPath),null!==this.subErrors)for(var c=0;c<this.subErrors.length;c++)this.subErrors[c].prefixWith(a,b);return this};var v={},w=l();return w.addLanguage("en-gb",u),w.tv4=w,w});var base=document.getElementsByTagName("base")[0];base&&base.setAttribute("href",settings.BASE_HREF),angular.module("openeis-ui",["angularFileUpload","ngAnimate","ngResource","ngRoute","ngSanitize","openeis-ui.components.modals","openeis-ui.directives.analysis-report","openeis-ui.directives.file-upload","openeis-ui.directives.sensor-container","openeis-ui.filters","openeis-ui.services.analyses","openeis-ui.services.applications","openeis-ui.services.auth","openeis-ui.services.data-files","openeis-ui.services.data-maps","openeis-ui.services.data-set-filters","openeis-ui.services.data-sets","openeis-ui.services.projects","openeis-ui.services.shared-analyses"]).config(["$routeProvider","$locationProvider","$httpProvider","authRouteProvider",function(a,b,c,d){a.otherwise({templateUrl:"404.tpl.html"}),b.html5Mode(!0),c.defaults.xsrfHeaderName="X-CSRFToken",c.defaults.xsrfCookieName="csrftoken",d.whenAnon("/",{controller:"LoginCtrl",templateUrl:"login.tpl.html"}).whenAnon("/recovery",{controller:"RecoveryCtrl",templateUrl:"recovery.tpl.html"}).whenAnon("/sign-up",{controller:"SignUpCtrl",templateUrl:"signup.tpl.html"}).whenAuth("/account",{controller:"AccountCtrl",templateUrl:"account.tpl.html"}).whenAuth("/projects",{controller:"ProjectsCtrl",templateUrl:"projects.tpl.html",resolve:{projects:["Projects",function(a){return a.query()}]}}).whenAuth("/projects/:projectId",{controller:"ProjectCtrl",templateUrl:"project.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataFiles:["DataFiles","$route",function(a,b){return a.query(b.current.params.projectId)}],dataSets:["DataSets","$route",function(a,b){return a.query(b.current.params.projectId).$promise}],dataMaps:["DataMaps","$route",function(a,b){return a.query(b.current.params.projectId).$promise}],analyses:["Analyses","$route",function(a,b){return a.query(b.current.params.projectId).$promise}],sharedAnalyses:["SharedAnalyses","$route",function(a,b){return a.query(b.current.params.projectId).$promise}]}}).whenAuth("/projects/:projectId/new-data-map",{controller:"NewDataMapCtrl",templateUrl:"new-data-map.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataFiles:["DataFiles","$route",function(a,b){return a.query(b.current.params.projectId)}],newDataMap:["$route","DataMaps",function(a,b){return b.getDefaultMap(a.current.params.projectId)}]}}).whenAuth("/projects/:projectId/new-data-set",{controller:"NewDataSetCtrl",templateUrl:"new-data-set.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataFiles:["DataFiles","$route",function(a,b){return a.query(b.current.params.projectId)}],dataMaps:["DataMaps","$route",function(a,b){return a.query(b.current.params.projectId)}]}}).whenAuth("/projects/:projectId/datamaps/:dataMapId",{controller:"DataMapCtrl",templateUrl:"data-map.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataMap:["DataMaps","$route",function(a,b){return a.get(b.current.params.dataMapId).$promise}]}}).whenAuth("/projects/:projectId/datamaps/:dataMapId/clone-and-edit",{controller:"NewDataMapCtrl",templateUrl:"new-data-map.tpl.html",resolve:{project:["Projects","$route",function(a,b){
return a.get(b.current.params.projectId)}],dataFiles:["DataFiles","$route",function(a,b){return a.query(b.current.params.projectId)}],newDataMap:["$q","$route","DataFiles","DataMaps",function(a,b,c,d){return a.all({dataMap:d.get(b.current.params.dataMapId).$promise,dataFiles:c.query(b.current.params.projectId)}).then(function(a){return d.ensureFileMetaData(a.dataFiles).then(function(){return d.unFlattenMap(a.dataMap,a.dataFiles)})})}]}}).whenAuth("/projects/:projectId/datasets/:dataSetId",{controller:"DataSetCtrl",templateUrl:"data-set.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataSet:["DataSets","$route",function(a,b){return a.get(b.current.params.dataSetId).$promise}],head:["DataSets","$route",function(a,b){return a.head(b.current.params.dataSetId).$promise}]}}).whenAuth("/projects/:projectId/datasets/:dataSetId/manipulate",{controller:"DataSetManipulateCtrl",templateUrl:"data-set-manipulate.tpl.html",resolve:{project:["Projects","$route",function(a,b){return a.get(b.current.params.projectId)}],dataSet:["DataSets","$route",function(a,b){return a.get(b.current.params.dataSetId).$promise}]}}).when("/shared-analyses/:analysisId/:key",{controller:"SharedAnalysesCtrl",templateUrl:"shared-analyses.tpl.html"})}]).controller("AppCtrl",["$http","$scope","Modals","Auth",function(a,b,c,d){b.modalOpen=c.modalOpen,b.$on("accountChange",function(){d.account().then(function(a){b.account=a})}),b.logOut=function(){d.logOut()},a.get(settings.API_URL+"version").success(function(a){b.version=["v",a.version," (",a.revision,"#",a.vcs_version,") ",a.updated].join("")})}]).run(["$rootScope","$rootElement",function(a,b){a.$on("$viewContentLoaded",function(){window.setTimeout(function(){b.find("input").checkAndTriggerAutoFillEvent()},200)})}]),angular.module("openeis-ui.components.modals",[]).directive("modal",["Modals","$document",function(a,b){return{restrict:"E",transclude:!0,template:['<div class="modal__backdrop" ng-if="modalOpen">','<div class="modal__dialog" ng-transclude></div>',"</div>"].join(""),scope:{},link:function(c,d,e){var f=b.find("body");c.$watch(function(){return a.modalOpen(e.modalId)},function(a){a?f.addClass("body--modal-open"):f.removeClass("body--modal-open"),c.modalOpen=a})}}}]).service("Modals",function(){var a=this,b={};a.openModal=function(a){b[a]=!0},a.closeModal=function(a){delete b[a]},a.modalOpen=function(a){return"undefined"==typeof a?!angular.equals(b,{}):b.hasOwnProperty(a)}}),angular.module("openeis-ui").controller("AccountCtrl",["$scope","Auth","$timeout",function(a,b,c){var d;b.account().then(function(b){a.account=b,d=angular.copy(b)}),a.$watchCollection("account",function(b){b.first_name!==d.first_name||b.email!=d.email?a.profile.changed=!0:a.profile.changed=!1}),a.profile={clearAlerts:function(){a.profile.success=!1,a.profile.error=!1},update:function(){a.profile.clearAlerts(),b.accountUpdate({first_name:a.account.first_name,email:a.account.email}).then(function(b){a.profile.success=!0,a.profile.changed=!1,d=angular.copy(a.account),c(a.profile.clearAlerts,2e3)},function(b){400===b.status&&angular.forEach(b.data,function(a,c){angular.isArray(a)&&(b.data[c]=a.join("<br>"))}),a.profile.error=b})}},a.password={clearAlerts:function(){a.password.mismatch=!1,a.password.success=!1,a.password.error=!1},update:function(){return a.password.clearAlerts(),a.password["new"]!==a.password.newConfirm?void(a.password.mismatch=!0):void b.accountPassword({old_password:a.password.current,new_password:a.password["new"]}).then(function(b){a.password.success=!0,a.password.current="",a.password["new"]="",a.password.newConfirm="",c(a.password.clearAlerts,2e3)},function(b){400===b.status&&angular.forEach(b.data,function(a,c){angular.isArray(a)&&(b.data[c]=a.join("<br>"))}),a.password.error=b})}}}]),angular.module("openeis-ui").controller("ConfigureTimestampCtrl",["$scope","DataFiles","$http","Modals",function(a,b,c,d){a.modal={columns:{},timeOffset:a.timestampFile.time_offset||0,timeZone:a.timestampFile.time_zone||jstz.determine().name()},a.timestampFile.timestamp&&a.timestampFile.timestamp.columns&&angular.forEach(a.timestampFile.timestamp.columns,function(b){a.modal.columns[b]=!0}),a.preview=function(){return a.selectedColumns=[],angular.forEach(a.modal.columns,function(b,c){b===!0&&a.selectedColumns.push(parseInt(c))}),a.selectedColumns.length?void b.timestamps(a.timestampFile.id,a.modal.timeOffset,a.modal.timeZone,a.selectedColumns.join(",")).then(function(b){a.modal.confirm=!0,a.modal.timestamps=b},function(a){alert(angular.toJson(a.data))}):void alert("Please select at least one column.")},a.save=function(){var c={columns:a.selectedColumns};b.update({id:a.timestampFile.id,timestamp:c,time_offset:a.modal.timeOffset,time_zone:a.modal.timeZone}).then(function(b){a.timestampFile.timestamp=c,a.timestampFile.time_zone=a.modal.timeZone,d.closeModal("configureTimestamp")},function(a){alert(angular.toJson(a))})}}]),angular.module("openeis-ui").controller("DataMapCtrl",["$scope","dataMap","project",function(a,b,c){a.dataMap=b,a.project=c}]),angular.module("openeis-ui").controller("DataSetCtrl",["$scope","project","dataSet","head",function(a,b,c,d){a.project=b,a.dataSet=c,a.data=d}]),angular.module("openeis-ui").controller("DataSetManipulateCtrl",["$location","$scope","DataMaps","DataSetFilters","DataSets","Modals","project","dataSet",function(a,b,c,d,e,f,g,h){b.Modals=f,b.project=g,b.dataSet=h,b.availableFilters=d.query(),b.topicFilters={},b.globalSettings={performFill:!0,performAggregation:!0,periodSeconds:3600,dropExtra:!0,roundTime:!1},b.$on("$locationChangeStart",function(a){b.filterAdded()&&!confirm("Abandon data set manipulation?")&&a.preventDefault()}),b.filterAdded=function(){var a=!1;return angular.forEach(b.topicFilters,function(b){b.other.length&&(a=!0)}),a},b.initTopicFilters=function(a,d){b.topicFilters[a]={fill:null,aggregation:null,other:[]},c.getDefinition().then(function(c){c.sensors[d.type]&&(b.topicFilters[a].fill=c.sensors[d.type].default_fill,b.topicFilters[a].aggregation=c.sensors[d.type].default_aggregation)})},b.addFilterTo=function(a){b.newFilter={topic:a},f.openModal("newFilter")},b.saveNewFilter=function(){var a={};angular.forEach(b.newFilter.filter.parameters,function(c,d){a[d]=b.newFilter.parameters[d]}),b.topicFilters[b.newFilter.topic].other.push([b.newFilter.topic,b.newFilter.filter.id,a]),f.closeModal("newFilter")},b.raiseFilter=function(a){var c=b.topicFilters[a[0]].other,d=c.indexOf(a);0!==d&&(c.splice(d,1),c.splice(d-1,0,a))},b.lowerFilter=function(a){var c=b.topicFilters[a[0]].other,d=c.indexOf(a);d!==c.length-1&&(c.splice(d,1),c.splice(d+1,0,a))},b.deleteFilter=function(a){var c=b.topicFilters[a[0]].other;c.splice(c.indexOf(a),1)},b.apply=function(){var c=[];b.applying=!0,angular.forEach(b.topicFilters,function(a,d){b.globalSettings.performFill&&a.fill&&c.push([d,a.fill,{period_seconds:b.globalSettings.periodSeconds,drop_extra:b.globalSettings.dropExtra}]),b.globalSettings.performAggregation&&c.push([d,a.aggregation,{period_seconds:b.globalSettings.periodSeconds,round_time:b.globalSettings.roundTime}]),a.other.length&&(c=c.concat(a.other))}),e.manipulate(h,c).then(function(){b.topicFilters={},a.url("projects/"+g.id)},function(a){var b=a.data;angular.isArray(b)?alert(b.join("\n")):alert(b)})["finally"](function(){delete b.applying})}}]),angular.module("openeis-ui").controller("LoginCtrl",["$scope","Auth",function(a,b){a.logIn=function(){b.logIn({username:a.form.username,password:a.form.password})["catch"](function(b){a.form.error=b.status})},a.clearError=function(){a.form.error=null}}]),angular.module("openeis-ui").controller("NewAnalysisCtrl",["$scope","Applications","DataMaps","$q","Modals","Analyses",function(a,b,c,d,e,f){a.newAnalysis={debug:!1},a.$watch("newAnalysis.dataSet",function(){a.availableApps=[],a.newAnalysis.dataSet&&b.query().$promise.then(function(b){a.availableSensors={},allSensors=["TerminalBoxDamperCommand","TerminalBoxFanAirflow","TerminalBoxReheatValvePosition","OccupancyMode","ZoneTemperature","ZoneTemperatureSetPoint"],angular.forEach(a.newAnalysis.dataSet.datamap.sensors,function(b,c){b.type&&(a.availableSensors.hasOwnProperty(b.type)||(a.availableSensors[b.type]=[],allSensors.indexOf(b.type)>-1&&a.availableSensors[b.type].push({display:"All",value:c+"/All"})),a.availableSensors[b.type].push({display:c,value:c}))}),angular.forEach(b,function(b){var c={},d=[];return b.name=b.name||b.id,angular.forEach(b.inputs,function(a){c.hasOwnProperty(a.sensor_type)||(c[a.sensor_type]=0),c[a.sensor_type]+=a.count_min}),angular.forEach(c,function(b,c){var e=0;a.availableSensors[c]&&(e=a.availableSensors[c].length),b>e&&d.push("At least "+b+" "+c+" required, "+e+" available in data set")}),d.length?void a.availableApps.push({name:b.name,description:b.description,missingInputs:d}):void a.availableApps.push(b)})})});var g;a.$watch("newAnalysis.application",function(b,c){b&&b!==g&&(a.newAnalysis.configuration={parameters:{},inputs:{}},angular.forEach(b.inputs,function(b,c){a.newAnalysis.configuration.inputs[c]=[];for(var d=0;d++<b.count_min;)a.newAnalysis.configuration.inputs[c].push({})}),g=b)}),a.setParamDefault=function(b){a.newAnalysis.application.parameters[b].hasOwnProperty("value_default")&&(a.newAnalysis.configuration.parameters[b]=a.newAnalysis.application.parameters[b].value_default)},a.canAddSensor=function(b,c){var d=a.newAnalysis.application,e=a.newAnalysis.configuration;return a.availableSensors[c]?e.inputs[b].length>=a.availableSensors[c].length?!1:d.inputs[b].count_max&&e.inputs[b].length>=d.inputs[b].count_max?!1:!0:!1},a.addInputSensor=function(b){a.newAnalysis.configuration.inputs[b].push({})},a.deleteInputSensor=function(b,c){a.newAnalysis.configuration.inputs[b].splice(c,1)},a.run=function(){f.create({name:a.newAnalysis.dataSet.name+" - "+a.newAnalysis.application.name,dataset:a.newAnalysis.dataSet.id,application:a.newAnalysis.application.id,configuration:a.newAnalysis.configuration,debug:a.newAnalysis.debug}).$promise.then(function(b){a.analyses.push(b),a.statusCheck(),e.closeModal("newAnalysis")},function(a){alert(angular.toJson(a.data,!0))})}}]),angular.module("openeis-ui").controller("NewDataMapCtrl",["$location","$scope","project","dataFiles","DataMaps","DataSets","Modals","newDataMap",function(a,b,c,d,e,f,g,h){b.project=c,b.dataFiles=d,b.Modals=g,b.isObject=angular.isObject,e.ensureFileMetaData(b.dataFiles),b.newDataMap=h,b.$on("$locationChangeStart",function(a){b.newDataMap.map.children.length&&!confirm("Abandon unsaved data map?")&&a.preventDefault()}),b.$watch("newDataMap.map",function(){e.validateMap(b.newDataMap.map).then(function(a){b.newDataMap.valid=a.valid})},!0),b.addChild=function(a){var c,d="Name:",e=function(a){return a.name===c};do{if(c=prompt(d),!c)return;c=c.replace("/","-"),d='Error: "'+c+'" already exists. Name:'}while(b.newDataMap.map.children.some(e));b.newDataMap.map.children.unshift({level:a,name:c})},b.preview=function(){function a(b){angular.forEach(b,function(b){b.deleted!==!0&&(b.file&&(d[b.file.id]||(d[b.file.id]={key:h++ +"",name:b.file.name})),b.sensors&&a(b.sensors),b.children&&a(b.children))})}var c=[],d={},h=0;a(b.newDataMap.map.children),b.dataMapPreviewFiles={},angular.forEach(d,function(a,d){c.push({name:a.key,file:d}),b.dataMapPreviewFiles[a.key]=a.name}),f.preview(e.flattenMap(b.newDataMap.map),c).$promise.then(function(a){b.dataMapPreview=a,g.openModal("dataMapPreview")})},b.showError=function(a){alert([b.dataMapPreviewFiles[a.file],": row ",a.row,", column ",a.column,"\n",a.error].join(""))},b.save=function(){e.create(b.newDataMap).$promise.then(function(){b.newDataMap.map.children=[],a.url("projects/"+c.id)},function(a){alert(a.data.__all__.join("\n"))})}}]),angular.module("openeis-ui").controller("NewDataSetCtrl",["$filter","$location","$scope","project","dataFiles","dataMaps","DataMaps","DataSets","Modals",function(a,b,c,d,e,f,g,h,i){c.project=d,c.dataFiles=e,c.dataMaps=f,c.Modals=i,c.isObject=angular.isObject,g.ensureFileMetaData(c.dataFiles),c.newDataSet={files:{}},c.showError=function(a){alert([c.newDataSet.files[a.file].name,": row ",a.row,", column ",a.column,"\n",a.error].join(""))},c.submit=function(){c[c.newDataSet.action]()},c.preview=function(){var a=[];angular.forEach(c.newDataSet.files,function(b,c){a.push({name:c,file:b.id})}),h.preview(c.newDataSet.map,a).$promise.then(function(a){c.dataSetPreview=a,i.openModal("dataSetPreview")})},c.save=function(){var e=[];angular.forEach(c.newDataSet.files,function(a,b){e.push({name:b,file:a.id})}),h.create({name:c.newDataSet.map.name+" - "+a("date")(Date.now(),"short"),map:c.newDataSet.map.id,files:e}).$promise.then(function(a){b.url("projects/"+d.id)},function(a){alert(angular.toJson(a.data,!0))})}}]),angular.module("openeis-ui").controller("ProjectCtrl",["$scope","project","dataFiles","DataFiles","dataSets","DataSets","dataMaps","$upload","$timeout","$q","$http","Modals","analyses","Analyses","sharedAnalyses","SharedAnalyses",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.project=b,a.dataFiles=c,a.dataSets=e,a.dataMaps=g,a.Modals=l,a.analyses=m,a.sharedAnalyses=o;var q;a.statusCheck=function(){angular.forEach(a.dataSets,function(b){if(!b.status||"complete"!==b.status.status.slice(-8)){var c=[];c.push(f.getStatus(b).then(function(a){b.status=a.data,"processing"===b.status.status&&(b.status.status+=" - "+Math.floor(parseFloat(b.status.percent))+"%")})),c.push(f.getErrors(b).then(function(a){b.errors=a.data})),j.all(c).then(function(){"complete"!==b.status.status.slice(-8)&&(i.cancel(q),q=i(a.statusCheck,1e3))})}}),angular.forEach(a.analyses,function(b){"complete"!==b.status.slice(-8)&&n.get(b.id).$promise.then(function(c){angular.extend(b,c),"complete"!==b.status.slice(-8)&&(i.cancel(q),q=i(a.statusCheck,1e3))})})},a.statusCheck(),a.configureTimestamp=function(b){var c={timeZones:k.get(settings.TIMEZONES_URL)};a.dataFiles[b].head||(c.head=d.head(a.dataFiles[b].id)),j.all(c).then(function(c){c.head&&(c.head.has_header&&(c.head.header=c.head.rows.shift()),a.dataFiles[b].head=c.head,a.dataFiles[b].cols=[],angular.forEach(a.dataFiles[b].head.rows[0],function(c,d){a.dataFiles[b].cols.push(d)})),a.timestampFile=a.dataFiles[b],a.timeZones=c.timeZones.data,l.openModal("configureTimestamp")})},a.upload=function(c){var e=[];return a.uploading=!0,angular.forEach(c,function(c){e.push(h.upload({url:settings.API_URL+"projects/"+b.id+"/add_file",file:c}).then(function(b){d.get(b.data.id).then(function(b){a.dataFiles.push(b),a.configureTimestamp(a.dataFiles.length-1)})}))}),j.all(e)["catch"](function(a){var b;b=a.data.file?a.data.file.join("\n"):a.data,alert(b)})["finally"](function(){delete a.uploading,l.closeModal("uploadFile")})},a.errorsModal={},a.showErrors=function(b){a.errorsModal.files={},angular.forEach(b.files,function(b){angular.forEach(a.dataFiles,function(c){c.id===b.file&&(a.errorsModal.files[b.name]=c.name)}),a.errorsModal.files[b.name]||(a.errorsModal.files[b.name]='File "'+b.name+'"')}),a.errorsModal.errors=b.errors,l.openModal("dataSetErrors")},a.rename=function(b,c){function d(e){if(!a[b])throw"Collection not found: "+b;var f,g=a[b][c].name;e=e||"",e.length&&(e+="\n\n"),e+="Rename '"+g+"' to:",f=prompt(e),null!==f&&(f.length?(a[b][c].name=f,a[b][c].$save(function(){"dataSets"===b&&a.statusCheck()},function(e){a[b][c].name=g,d(e.data.__all__.join("\n"))})):d("Name cannot be empty."))}d()},a["delete"]=function(c,d){if(!a[c])throw"Collection not found: "+c;confirm("Delete '"+a[c][d].name+"'?")&&a[c][d].$delete(function(){a[c].splice(d,1),"sharedAnalyses"===c&&(a.sharedAnalyses=p.query(b.id))})},a.viewAnalysis=function(b){a.viewingAnalysis=b,delete a.viewingAnalysisData,l.openModal("viewAnalysis"),n.getData(b.id).then(function(b){a.viewingAnalysisData=b})},a.getAnalysisOutputUrl=function(a){return settings.API_URL+"analyses/"+a+"/download"},a.shareAnalysis=function(b){p.create(b.id).$promise.then(function(c){a.sharedAnalyses.push(c),a.viewLink(b.id)})},a.viewLink=function(b){angular.forEach(a.sharedAnalyses,function(c){c.analysis===b&&(a.viewingLink={url:window.location.protocol+"//"+window.location.host+"/shared-analyses/"+b+"/"+c.key,sharedAnalysis:c},l.openModal("viewLink"))})},a.revokeLink=function(b){confirm("Revoke sharing?")&&(angular.forEach(a.sharedAnalyses,function(c){c.analysis===b&&c.$delete(function(){a.sharedAnalyses.splice(a.sharedAnalyses.indexOf(c),1)})}),l.closeModal("viewLink"))}}]),angular.module("openeis-ui").controller("ProjectsCtrl",["$scope","projects","Projects",function(a,b,c){a.projects=b,a.newProject={name:"",create:function(){c.create({name:a.newProject.name}).then(function(b){a.newProject.name="",a.projects.push(b)})}},a.renameProject=function(b){var c=prompt("New project name:");c&&c.length&&(a.projects[b].name=c,a.projects[b].$save(function(c){a.projects[b]=c}))},a.deleteProject=function(b){a.projects[b].$delete(function(){a.projects.splice(b,1)})},a.cloneProject=function(b){var d=prompt("Cloned project name:");d&&d.length&&c.clone(a.projects[b].id,d).then(function(b){a.projects.push(b)})}}]),angular.module("openeis-ui").controller("RecoveryCtrl",["$scope","Auth","$routeParams",function(a,b,c){a.form={stage:1},c.username&&c.code?(a.form.stage=2,a.recovery={username:c.username,code:c.code}):a.recovery={},a.submit=function(){switch(a.form.stage){case 1:return void b.accountRecover1(a.recovery.id).then(function(){a.form.success="Email with temporary password reset link sent.",a.form.stage=!1,a.clearError()},function(b){404===b.status&&(b.data="Account with specified username or email address not found."),a.form.error=b});case 2:return a.recovery.password!==a.recovery.passwordConfirm?void(a.form.error={status:400,data:"Passwords do not match."}):void b.accountRecover2(a.recovery).then(function(){a.form.success="Password updated.",a.form.stage=!1,a.clearError()},function(b){404===b.status&&(b.data="Invalid password reset link."),a.form.error=b})}},a.clearError=function(){a.form.error=!1}}]),angular.module("openeis-ui").controller("SharedAnalysesCtrl",["$scope","SharedAnalyses","$routeParams","$location",function(a,b,c,d){a.valid=!0,b.get(c.analysisId,c.key).$promise.then(function(d){a.sharedAnalysis=d,b.getData(d.analysis,c.key).then(function(b){a.data=b})},function(){a.valid=!1})}]),angular.module("openeis-ui").controller("SignUpCtrl",["$scope","$location","Auth",function(a,b,c){a.form={},a.submit=function(){return a.account.password!==a.account.passwordConfirm?void(a.form.passwordConfirm="Passwords do not match."):void c.accountCreate(a.account).then(function(b){c.logIn({username:a.account.username,password:a.account.password})["catch"](function(b){a.form.error=b.status})},function(b){400===b.status&&angular.forEach(b.data,function(a,c){angular.isArray(a)&&(b.data[c]=a.join("<br>"))}),a.form.error=b})},a.clearError=function(){a.form.error=null}}]),angular.module("openeis-ui.directives.analysis-report",[]).directive("analysisReport",["$compile",function(a){function b(a,b,c){var d={top:20,right:20,bottom:30,left:50},e=920-d.left-d.right,f=300-d.top-d.bottom,g=d3.scale.linear().range([0,e]),h=d3.scale.linear().range([f,0]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left"),k=d3.svg.line().x(function(a){return g(a.x)}).y(function(a){return h(a.y)}).interpolate("basis"),l=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),m=l.append("g").attr("transform","translate("+d.left+","+d.top+")");return g.domain(d3.extent(a,function(a){return a.x})),h.domain(d3.extent(a,function(a){return a.y})),m.append("g").attr("class","line-plot__axis line-plot__axis--x").attr("transform","translate(0,"+f+")").call(i),m.append("g").attr("class","line-plot__axis line-plot__axis--y").call(j).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),m.append("path").datum(a).attr("class","line-plot__line").attr("d",k),l[0]}function c(a,b,c){var d={top:20,right:20,bottom:30,left:50},e=920-d.left-d.right,f=300-d.top-d.bottom,g=d3.scale.ordinal().rangeRoundBands([0,e],.1),h=d3.scale.linear().range([f,0]),i=d3.svg.axis().scale(g).orient("bottom"),j=d3.svg.axis().scale(h).orient("left"),k=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),l=k.append("g").attr("transform","translate("+d.left+","+d.top+")");return g.domain(a.map(function(a){return a.x})),h.domain([0,d3.max(a,function(a){return a.y})]),l.append("g").attr("class","bar-chart__axis bar-chart__axis--x").attr("transform","translate(0,"+f+")").call(i).text(b),l.append("g").attr("class","bar-chart__axis bar-chart__axis--y").call(j).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),l.selectAll("bar-chart__bar").data(a).enter().append("rect").attr("class","bar-chart__bar").attr("x",function(a){return g(a.x)}).attr("width",g.rangeBand()).attr("y",function(a){return h(a.y)}).attr("height",function(a){return f-h(a.y)}),k[0]}function e(a,b,c){var d={top:20,right:20,bottom:30,left:40},e=920-d.left-d.right,f=300-d.top-d.bottom,g=function(a){return a.x},h=d3.scale.linear().range([0,e]),i=function(a){return h(g(a))},j=d3.svg.axis().scale(h).orient("bottom"),k=function(a){return a.y},l=d3.scale.linear().range([f,0]),m=function(a){return l(k(a))},n=d3.svg.axis().scale(l).orient("left"),o=function(a){return 0},p=d3.scale.category10(),q=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),r=q.append("g").attr("transform","translate("+d.left+","+d.top+")");d3.select("body").append("div").attr("class","tooltip").style("opacity",0);return h.domain([d3.min(a,g)-1,d3.max(a,g)+1]),l.domain([d3.min(a,k)-1,d3.max(a,k)+1]),r.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j).append("text").attr("class","label").attr("x",e).attr("y",-6).style("text-anchor","end").text(b),r.append("g").attr("class","y axis").call(n).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),r.selectAll(".dot").data(a).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",i).attr("cy",m).style("fill",function(a){return p(o(a))}).append("svg:title").text(function(a){return b+": "+a.x+"\n"+c+": "+a.y}),q[0]}function f(a,b,c){var d={top:20,right:20,bottom:180,left:40},e=920-d.left-d.right,f=450-d.top-d.bottom,g=function(a){return Date.parse(a.x)},h=d3.time.scale().range([0,e]),i=function(a){return h(g(a))},j=d3.svg.axis().scale(h).orient("bottom").ticks(30),k=function(a){return a.y},l=d3.scale.linear().range([f,0]),m=function(a){return l(k(a))},n=d3.svg.axis().scale(l).orient("left"),o=function(a){return 0},p=d3.scale.category10(),q=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom),r=q.append("g").attr("transform","translate("+d.left+","+d.top+")");d3.select("body").append("div").attr("class","tooltip").style("opacity",0);h.domain([d3.min(a,g)-1,d3.max(a,g)+1]),l.domain([d3.min(a,k)-1,d3.max(a,k)+1]);var s=[["%Y-%m",function(a){return a.getMonth()}],["%Y-%m-%d",function(a){return a.getDate()}],["%Y-%m-%d %H:%M",function(a){return a.getHours()}],["%Y-%m-%d %H:%M:%S",function(a){return a.getSeconds()}]];return j.tickFormat(d3.time.format("%Y")),h.ticks.apply(h,j.ticks()).forEach(function(a){for(;s.length&&s[0][1](a);)j.tickFormat(d3.time.format(s[0][0])),s.shift()}),r.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(j).append("text").attr("class","label").attr("x",e).attr("y",-6).style("text-anchor","end").text(b),r.selectAll(".x.axis > .tick > text").style("text-anchor","end").attr("transform","rotate(-90)").attr("dx","-.5em").attr("dy","-.5em"),r.append("g").attr("class","y axis").call(n).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(c),r.selectAll(".dot").data(a).enter().append("circle").attr("class","dot").attr("r",3.5).attr("cx",i).attr("cy",m).style("fill",function(a){return p(o(a))}).append("svg:title").text(function(a){return b+": "+a.x+"\n"+c+": "+a.y}),q[0]}function g(a,b,c){var d={top:50,right:0,bottom:100,left:100},e=960-d.left-d.right,f=Math.floor(e/24),g=d3.set(a.map(function(a){return a.y})).values();height=(g.length+1)*f,legendElementWidth=2*f,buckets=9,colors=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"];var h=d3.scale.quantile().domain(d3.extent(a,function(a){return a.z})).range(colors),i=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",e+d.left+d.right).attr("height",height+d.top+d.bottom),j=i.append("g").attr("transform","translate("+d.left+","+d.top+")"),k=(j.selectAll(".yLabel").data(g).enter().append("text").text(function(a){return a}).attr("x",0).attr("y",function(a,b){return b*f}).style("text-anchor","end").attr("transform","translate(-6,"+f/1.5+")").attr("class","yLabel"),j.selectAll(".xLabel").data(d3.range(24)).enter().append("text").text(function(a){return a}).attr("x",function(a,b){return b*f}).attr("y",0).style("text-anchor","middle").attr("transform","translate("+f/2+", -6)").attr("class","xLabel"),j.selectAll(".value").data(a).enter().append("rect").attr("x",function(a){return a.x*f}).attr("y",function(a){return g.indexOf(a.y)*f}).attr("rx",4).attr("ry",4).attr("class","value bordered").attr("width",f).attr("height",f).style("fill",colors[0]));k.transition().duration(1e3).style("fill",function(a){return h(a.z)}),k.append("title").text(function(a){return a.z});var l=j.selectAll(".legend").data([0].concat(h.quantiles()),function(a){return a}).enter().append("g").attr("class","legend");return l.append("rect").attr("x",function(a,b){return legendElementWidth*b}).attr("y",height).attr("width",legendElementWidth).attr("height",f/2).style("fill",function(a,b){return colors[b]}),l.append("text").attr("class","mono").text(function(a){return"≥ "+Math.round(a)}).attr("x",function(a,b){return legendElementWidth*b}).attr("y",height+f),i[0]}function h(a){var b=a.getDate();10>b&&(b="0"+b);var c=a.getMonth()+1;10>c&&(c="0"+c);var d=a.getFullYear();return d+"-"+c+"-"+b}function j(a){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=b[a.getDay()];return c+" "+h(a)}function k(a,b){for(var c=[];b>=a;)c.push(a++);return c}function l(a){var b=a-Math.floor(a);return a-=b,("0"+a).slice(-2)+b.toString().substr(1)}function m(a,b,c){var d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],e=[],f=0;for(i=1;i<c.length;i++)e[i-1]=c[i]-c[i-1],f+=e[i-1];var g=(f/e.length,new Rickshaw.Fixtures.Time,(b-a)/6),h=[{name:"decade",seconds:315576e3,formatter:function(a){return 10*parseInt(a.getUTCFullYear()/10,10)}},{name:"year",seconds:31557600,formatter:function(a){return a.getUTCFullYear()}},{name:"month",seconds:2635200,formatter:function(a){return(new Rickshaw.Fixtures.Time).months[a.getUTCMonth()]}},{name:"week",seconds:604800,formatter:function(a){return(new Rickshaw.Fixtures.Time).formatDate(a)}},{name:"day",seconds:86400,formatter:function(a){return d[a.getDay()]+" "+a.getMonth()+"-"+a.getDate()+"-"+a.getFullYear().toString().substr(2,2)}},{name:"6 hour",seconds:21600,formatter:function(a){return 11==a.getHours()?l(a.getMonth())+"-"+l(a.getDate())+" "+l(a.getHours())+":"+l(a.getMinutes()):l(a.getHours())+":"+l(a.getMinutes())}},{name:"hour",seconds:3600,formatter:function(a){return 11==a.getHours()?l(a.getMonth())+"-"+l(a.getDate())+" "+l(a.getHours())+":"+l(a.getMinutes()):l(a.getHours())+":"+l(a.getMinutes())}},{name:"15 minute",seconds:900,formatter:function(a){return 11==a.getHours()?l(a.getMonth())+"-"+l(a.getDate())+" "+l(a.getHours())+":"+l(a.getMinutes()):l(a.getHours())+":"+l(a.getMinutes())}},{name:"minute",seconds:60,formatter:function(a){return 11==a.getHours()?l(a.getMonth())+"-"+l(a.getDate())+" "+l(a.getHours())+":"+l(a.getMinutes()):l(a.getHours())+":"+l(a.getMinutes())}},{name:"15 second",seconds:15,formatter:function(a){return a.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(a){return a.getUTCSeconds()+"s"}},{name:"decisecond",seconds:.1,formatter:function(a){return a.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:.01,formatter:function(a){return a.getUTCMilliseconds()+"ms"}}],j=0,k=312984e3;for(i=0;i<h.length;i++)Math.abs(g-h[i].seconds)<k&&(k=Math.abs(g-h[i].seconds),j=i);var m=h[j].seconds,n=h[j].formatter,o={};return o.formatTime=function(a){return n(a)},o.formatter=function(a){return this.formatTime(a)},o.name="auto-defined",o.seconds=m,o}function n(a,b,c){var d={};a.forEach(function(a){var c=a.diagnostic_name;if(null!==c){var e=w(a.datetime),f=h(e),g=e.getHours().toString();f in d?c in d[f]?g in d[f][c]?b[a.color_code].state_value>=b[d[f][c][g].color_code].state_value&&(d[f][c][g]=a):d[f][c][g]=a:(d[f][c]={},d[f][c][g]=a):(d[f]={},d[f][c]={},d[f][c][g]=a)}});var e=[],f=[];for(var g in d)if(d.hasOwnProperty(g)){var i=g.split("-"),j=new Date(i[0],i[1]-1,i[2],0,0,0,0);f.push(j)}for(var k=d3.extent(f),l=k[1],m=k[0],n=Math.round(Math.abs((l-m)/864e5)),o=0;n>=o;o++){var p=new Date(m.getTime());p.setDate(p.getDate()+o);var q=h(p);if(d.hasOwnProperty(q))for(var r=0;r<c.length;r++){var s="NA";if(d[q].hasOwnProperty(c[r])){for(var t=[],u={state:b.GREY.string,diagnostic:"",diagnostic_message:b.GREY.value,energy_impact:"NA"},v=0;24>v;v++){var x=v.toString();d[q][c[r]].hasOwnProperty(x)&&(null!=d[q][c[r]][x].energy_impact&&(s=d[q][c[r]][x].energy_impact),b[d[q][c[r]][x].color_code].state_value>=b[u.state].state_value&&(u={state:d[q][c[r]][x].color_code,diagnostic:d[q][c[r]][x].diagnostic_name,diagnostic_message:d[q][c[r]][x].diagnostic_message,energy_impact:s}))}var y=u.state;u.state==b.RED.string&&(y=b.GREEN.string),s="NA";for(var v=0;24>v;v++){var x=v.toString();d[q][c[r]].hasOwnProperty(x)?(null!=d[q][c[r]][x].energy_impact&&(s=d[q][c[r]][x].energy_impact),t.push({date:p,y:v,state:d[q][c[r]][x].color_code,diagnostic:d[q][c[r]][x].diagnostic_name,diagnostic_message:d[q][c[r]][x].diagnostic_message,energy_impact:s})):t.push({date:p,y:v,state:y,diagnostic:"",diagnostic_message:b[y].value,energy_impact:"NA"})}e.push({date:p,y:r,state:u.state,diagnostic:u.diagnostic,diagnostic_message:u.diagnostic_message,energy_impact:u.energy_impact,hourly_result:t})}else{for(var t=[],v=0;24>v;v++)t.push({date:p,y:v,state:b.GREEN.string,diagnostic:"",diagnostic_message:b.GREEN.value,energy_impact:"NA"});e.push({date:p,y:r,state:b.GREEN.string,diagnostic:"",diagnostic_message:b.GREEN.value,energy_impact:"NA",hourly_result:t})}}else for(var r=0;r<c.length;r++){for(var t=[],v=0;24>v;v++)t.push({date:p,y:v,state:b.GREEN.string,diagnostic:"",diagnostic_message:b.GREEN.value,energy_impact:"NA"});e.push({date:p,y:r,state:b.GREEN.string,diagnostic:"",diagnostic_message:b.GREEN.value,energy_impact:"NA",hourly_result:t})}}return e}function o(a,b){function c(){L.select("g.x.axis").call(I),L.select("g.y.axis").call(J),$.selectAll("circle").attr("cx",function(a){var b=G(a.date);return 0>b&&(b=-1e4),b})}function d(a,b){var c=d.canvas||(d.canvas=document.createElement("canvas")),e=c.getContext("2d");e.font=b;var f=e.measureText(a);return f.width}var e=["Temperature Sensor Dx","Economizing When Unit Should Dx","Economizing When Unit Should Not Dx","Excess Outdoor-air Intake Dx","Insufficient Outdoor-air Intake Dx"],f=["HW Differential Pressure Control Loop Dx","HW Supply Temperature Control Loop Dx","HW loop High Differential Pressure Dx","HW loop Differential Pressure Reset Dx","HW loop High Supply Temperature Dx","HW loop Supply Temperature Reset Dx","HW loop Low Delta-T Dx"],g=["Duct Static Pressure Control Loop Dx","Low Duct Static Pressure Dx","High Duct Static Pressure Dx","No Static Pressure Reset Dx","Supply-air Temperature Control Loop Dx","Low Supply-air Temperature Dx","High Supply-air Temperature Dx","No Supply-air Temperature Reset Dx","Operational Schedule Dx"];
1==b&&(g=["Duct Static Pressure Control Loop Dx","Low Duct Static Pressure Dx","High Duct Static Pressure Dx","No Static Pressure Reset Dx"]),2==b&&(g=["Supply-air Temperature Control Loop Dx","Low Supply-air Temperature Dx","High Supply-air Temperature Dx","No Supply-air Temperature Reset Dx"]),3==b&&(g=["Operational Schedule Dx"]);for(var h=null,i=!1,l=0;l<a.length&&!i;l++)e.indexOf(a[l].diagnostic_name)>-1&&(h=e,i=!0),f.indexOf(a[l].diagnostic_name)>-1&&(h=f,i=!0),g.indexOf(a[l].diagnostic_name)>-1&&(h=g,i=!0);if(i){var m=1024,o=100*h.length,p={top:40,right:0,bottom:150,left:360},q={top:30,right:30,bottom:50,left:30},r=m-p.left-p.right,s=o-p.top-p.bottom;0>s&&(o=250,s=80);var t=8,u="#ccc",v=d3.time.format("%b %d"),w=h,x={GREY:{value:"No Diagnosis",color:"#B3B3B3",state_value:0,string:"GREY"},GREEN:{value:"Normal",color:"#509E7A",state_value:1,string:"GREEN"},RED:{value:"Fault",color:"#E22400",state_value:2,string:"RED"}},y=w,z=d3.select(document.createElementNS("http://www.w3.org/2000/svg","svg")).attr("width",m).attr("height",o),A=n(a,x,h),B=d3.extent(A,function(a){return a.date}),C=w.length,D=6,E=Math.floor((r-q.left-q.right)/D),F=E*(A.length/C),G=d3.time.scale().domain(B).range([q.left,q.left+F]),H=d3.scale.ordinal().domain(y).rangePoints([s-q.top,q.bottom]),I=d3.svg.axis().scale(G).orient("bottom").ticks(d3.time.day).tickFormat(v),J=d3.svg.axis().scale(H).orient("left"),K=d3.behavior.zoom().scaleExtent([1,1]).on("zoom",c);K.x(G);var L=z.append("g").attr("transform","translate("+p.left+","+p.top+")");L.append("rect").attr("class","pane").attr("width",r).attr("height",s).call(K);var M=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"Date: <strong>"+j(a.date)+"</strong><br/>Diagnostic Message: <strong>"+a.diagnostic_message+"</strong></strong><br/>Energy Impact: <strong>"+a.energy_impact+"</strong></strong><br/>(Click to see hourly result)<br/>"}),N=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"Date: <strong>"+j(a.date)+"</strong><br/>Hour: <strong>"+(a.y+1)+"</strong><br/>Diagnostic Message: <strong>"+a.diagnostic_message+"</strong></strong><br/>Energy Impact: <strong>"+a.energy_impact+"</strong></strong><br/>"});L.call(M),L.call(N);var O=z.append("g").attr("transform","translate("+m/3+","+p.top/3+")"),P=324,Q=34,R=15;O.append("rect").attr("width",P).attr("height",Q).attr("x",0).attr("y",0).attr("rx",5).attr("ry",5).style("stroke","#909090").style("stroke-width",1).style("fill","none");var S=R,T=[];for(var U in x)x.hasOwnProperty(U)&&T.push(x[U]);var V=O.selectAll("g").data(T).enter().append("g").attr("transform",function(a,b){if(b>0){var c=2*t,e=d(T[b-1].value,"17pt sans-serif");S+=c+e}return"translate("+S+","+Q/2+")"});V.append("circle").attr("cx",0).attr("cy",0).attr("r",t).attr("fill",function(a){return a.color}).attr("opacity",1).on("mouseover",null).on("mouseout",null),V.append("text").attr("x",2*t+1).attr("y",0).attr("dy",".35em").text(function(a){return a.value}).style("font-size","1em").style("font-family","sans-serif");var W=L.append("g").attr("id","xAxisEle_AFDD").attr("class","x axis");W.attr("clip-path","url(#clip_AFDD)").attr("transform","translate(0,"+(s-5)+")"),L.append("g").attr("class","y axis"),L.selectAll("line.y").data(y).enter().append("line").attr("class","yAxis").attr("x1",0).attr("x2",F).attr("y1",H).attr("y2",H).style("stroke",u),L.append("clipPath").attr("id","clip_AFDD").append("rect").attr("x",0).attr("y",0).attr("width",r).attr("height",s);var X=2*Math.PI,Y=20,Z=d3.scale.linear().domain([0,Y-1]).range([0,X]),$=(d3.svg.line.radial().interpolate("basis").tension(0).radius(t).angle(function(a,b){return Z(b)}),L.append("g").attr("clip-path","url(#clip_AFDD)"));return $.selectAll("circle").data(A).enter().append("circle").attr("cx",function(a){return G(a.date)}).attr("cy",function(a){return H(y[a.y])}).attr("r",t).attr("fill",function(a){return x[a.state].color}).attr("opacity",1).on("mouseover",M.show).on("mouseout",M.hide).on("click",function(a){var b=24,c=k(1,24),d=d3.scale.ordinal().domain(c).rangeRoundBands([0,24*b]),e=d3.svg.axis().scale(d).orient("bottom"),f=p.left+40;d3.select("#hrData").remove();var g=z.append("g").attr("id","hrData").attr("width",24*b).attr("height",b).attr("transform","translate(0,"+(s+100)+")");g.append("g").attr("class","x axis").attr("transform","translate("+f+","+b+")").call(e);var i=g.append("g").attr("class","axis");i.append("text").attr("x",80).attr("y",b-7).text(h[a.y]),i.append("text").attr("x",80).attr("y",b+20).text("("+j(a.date)+")"),g.selectAll("rect").data(a.hourly_result).enter().append("rect").attr("x",function(a){return a.y*b+f}).attr("y",0).attr("width",b).attr("height",b).attr("fill",function(a){return x[a.state].color}).attr("opacity",1).style({"stroke-width":1,stroke:"black"}).on("mouseover",N.show).on("mouseout",N.hide)}),c(),z[0]}}function p(a,b){return b.hasOwnProperty(a)?!0:!1}function q(a,b){return a.substring(0,b.length+3)===b+"___"?!0:!1}function r(a,b){for(var c in b)if(b.hasOwnProperty(c)&&q(c,a))return!0;return!1}function s(a){a="undefined"!=typeof a?a:"Temperature";var b={text:a,color:"black",opacity:.5,fontSize:"12px",offsetX:"18.5em",offsetY:"30em"};return b}function t(a){a="undefined"!=typeof a?a:"Temperature";var b={text:a,color:"black",opacity:.5,fontSize:"12px",offsetX:"0.8em",offsetY:"-8.5em"};return b}function u(a){a="undefined"!=typeof a?a:"Command/Status";var b={text:a,color:"black",opacity:.5,fontSize:"12px",offsetX:"3em",offsetY:"-8em"};return b}function v(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(null==a[b[d]]?delete a[b[d]]:(a[b[d]]=parseFloat(a[b[d]]),c[d]+=1))}function w(a){var b=a.split(/[^0-9]/);return new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])}function x(a){var b=["Blue","BlueViolet","Brown","BurlyWood","CadetBlue","DarkGray","DarkGrey","DarkGreen","DarkKhaki","Magenta","Green","Red","Chocolate","HotPink","LightPink","Gainsboro","AliceBlue","AntiqueWhite","Aqua","Aquamarine","Azure","Beige","Bisque","Black","BlanchedAlmond","Chartreuse","Coral","CornflowerBlue","Cornsilk","Crimson","Cyan","DarkBlue","DarkCyan","DarkGoldenRod","DarkMagenta","DarkOliveGreen","Darkorange","DarkOrchid","DarkRed","DarkSalmon","DarkSeaGreen","DarkSlateBlue","DarkSlateGray","DarkSlateGrey","DarkTurquoise","DarkViolet","DeepPink","DeepSkyBlue","DimGray","DimGrey","DodgerBlue","FireBrick","FloralWhite","ForestGreen","Fuchsia","GhostWhite","Gold","GoldenRod","Gray","Grey","GreenYellow","HoneyDew","IndianRed","Indigo","Ivory","Khaki","Lavender","LavenderBlush","LawnGreen","LemonChiffon","LightBlue","LightCoral","LightCyan","LightGoldenRodYellow","LightGray","LightGrey","LightGreen","LightSalmon","LightSeaGreen","LightSkyBlue","LightSlateGray","LightSlateGrey","LightSteelBlue","LightYellow","Lime","LimeGreen","Linen","Maroon","MediumAquaMarine","MediumBlue","MediumOrchid","MediumPurple","MediumSeaGreen","MediumSlateBlue","MediumSpringGreen","MediumTurquoise","MediumVioletRed","MidnightBlue","MintCream","MistyRose","Moccasin","NavajoWhite","Navy","OldLace","Olive","OliveDrab","Orange","OrangeRed","Orchid","PaleGoldenRod","PaleGreen","PaleTurquoise","PaleVioletRed","PapayaWhip","PeachPuff","Peru","Pink","Plum","PowderBlue","Purple","RosyBrown","RoyalBlue","SaddleBrown","Salmon","SandyBrown","SeaGreen","SeaShell","Sienna","Silver","SkyBlue","SlateBlue","SlateGray","SlateGrey","Snow","SpringGreen","SteelBlue","Tan","Teal","Thistle","Tomato","Turquoise","Violet","Wheat","White","WhiteSmoke","Yellow","YellowGreen"];return b[a]}function y(a){function b(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("OATemp",c)||!p("MATemp",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,100]),o=d3.scale.linear().domain([0,300]),q={};p("OATemp",c)&&(q.OATemp={name:"Outdoor Air Temperature",color:d.OATemp,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OATemp]}}),scale:n}),p("MATemp",c)&&(q.MATemp={name:"Mixed Air Temperature",color:d.MATemp,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.MATemp]}}),scale:n}),p("RATemp",c)&&(q.RATemp={name:"Return Air Temperature",color:d.RATemp,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.RATemp]}}),scale:n}),p("OAF",c)&&(q.OAF={name:"Outdoor Air Fraction",color:d.OAF,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OAF]}}),scale:o}),p("DATemp",c)&&(q.DATemp={name:"Discharge Air Temperature",color:d.DATemp,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DATemp]}}),scale:n}),p("OADamper",c)&&(q.OADamper={name:"Outdoor Damper Signal",color:d.OADamper,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OADamper]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t()});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function c(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("OATemp",c)||!p("DATemp",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,100]),o=d3.scale.linear().domain([0,300]),q={};p("OATemp",c)&&(q.OATemp={name:"Outdoor Air Temperature",color:d.OATemp,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OATemp]}}),scale:n}),p("DATemp",c)&&(q.DATemp={name:"Discharge Air Temperature",color:d.DATemp,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DATemp]}}),scale:n}),p("DATempSetPoint",c)&&(q.DATempSetPoint={name:"Discharge Air Temperature Set Point",color:d.DATempSetPoint,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DATempSetPoint]}}),scale:n}),p("OADamper",c)&&(q.OADamper={name:"Outdoor Damper Signal",color:d.OADamper,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OADamper]}}),scale:o}),p("CCValve",c)&&(q.CCValve={name:"Cooling Coil Valve Position",color:d.CCValve,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.CCValve]}}),scale:o}),p("HCValve",c)&&(q.HCValve={name:"Heating Coil Valve Position",color:d.HCValve,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HCValve]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t()});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function d(a,b,c,d,e){var f=e.Container,g=f+" .rs-chart",h=f+" .rs-y-axis",i=f+" .rs-legend",j=f+" .title";if(document.querySelector(j).innerHTML=e.Title,!p("MATemp",c)||!p("OATemp",c))return $(f).find(".rs-chart-area").toggle(),!1;a.sort(function(a,c){return a[b.OATemp]<c[b.OATemp]?-1:a[b.OATemp]>c[b.OATemp]?1:0});var k={MAOAT:{name:b.MATemp,xName:b.OATemp,color:d.MATemp,data:a.map(function(a){return{x:a[c.OATemp],y:a[c.MATemp]}})}},l=new Rickshaw.Graph({element:document.querySelector(g),renderer:"scatterplot",series:[k.MAOAT]});l.renderer.dotSize=2,l.render();var m=new Rickshaw.Graph.Legend({graph:l,element:document.querySelector(i)}),n=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Axis.X({graph:l,label:s("Outdoor Temperature")}));n.render();var o=new Rickshaw.Graph.Axis.Y({graph:l,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(h),label:t("Mixed-Air Temperature")});o.render()}var e="datetime",f={OAF:"OutdoorAirFraction",OATemp:"OutdoorAirTemperature",MATemp:"MixedAirTemperature",RATemp:"ReturnAirTemperature",DATemp:"DischargeAirTemperature",DATempSetPoint:"DischargeAirTemperatureSetPoint",OADamper:"OutdoorDamper",CCValve:"CCV",HCValve:"HCV"};counts={},points={};for(var g in f)counts[g]=0,points[g]=f[g];var h={OATemp:"blue",MATemp:"pink",RATemp:"red",DATemp:"green",OADamper:"brown",OAF:"blueviolet",CCValve:"darkorange",HCValve:"darkorchid",DATempSetPoint:"darkred"},i="FTimestamp";a.forEach(function(a){var b=a[e].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[i]=b,v(a,points,counts)});for(var g in counts)0==counts[g]&&delete points[g];var j=m(a[0][i],a[a.length-1][i],[a[0][i],a[1][i],a[2][i]]),k={Timestamp:i,Title:"AHU Economizer Performance Evaluation",Container:"#temps-chart-box",TimeUnit:j};b(a,f,points,h,k);var l={Timestamp:i,Title:"AHU Discharge Cooling and Economizer Performance Analysis",Container:"#hcv-box",TimeUnit:j};c(a,f,points,h,l);var n={Timestamp:i,Title:"Seasonal AHU Mixed Air Temperature Response Analysis",Container:"#mat-oat-box"};d(a,f,points,h,n),$(".rs-chart-container.hidden").removeClass("hidden")}function z(a){function b(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("OutdoorAirTemperature",c)&&!p("OutdoorDamper",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,200]),o=d3.scale.linear().domain([0,100]),q={};p("OutdoorAirTemperature",c)&&(q.OutdoorAirTemperature={name:"Outdoor Air Temperature",color:d.OutdoorAirTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OutdoorAirTemperature]}}),scale:n}),p("OutdoorAirFraction",c)&&(q.OutdoorAirFraction={name:c.OutdoorAirFraction,color:d.OutdoorAirFraction,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OutdoorAirFraction]}}),scale:o}),p("OutdoorDamper",c)&&(q.OutdoorDamper={name:"Outdoor Damper Signal",color:d.OutdoorDamper,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OutdoorDamper]}}),scale:o}),p("OccupancyMode",c)&&(q.OccupancyMode={name:"Occupancy Mode",color:d.OccupancyMode,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OccupancyMode]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t()});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function c(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("DuctStaticPressure",c)&&!p("DuctStaticPressureSetPoint",c)&&!p("SupplyFanSpeed",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,100]),o=d3.scale.linear().domain([0,200]),q={};p("DuctStaticPressure",c)&&(q.DuctStaticPressure={name:"Duct Static Pressure",color:d.DuctStaticPressure,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DuctStaticPressure]}}),scale:n}),p("DuctStaticPressureSetPoint",c)&&(q.DuctStaticPressureSetPoint={name:"Duct Static Pressure Set Point",color:d.DuctStaticPressureSetPoint,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DuctStaticPressureSetPoint]}}),scale:o}),p("SupplyFanSpeed",c)&&(q.SupplyFanSpeed={name:"Supply Fan Speed",color:d.SupplyFanSpeed,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.SupplyFanSpeed]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t("Pressure")});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function d(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("CCV",c)&&!p("HCV",c)&&!p("OutdoorAirTemperature",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,200]),o=d3.scale.linear().domain([0,100]),q={};p("OutdoorAirTemperature",c)&&(q.OutdoorAirTemperature={name:"Outdoor Air Temperature",color:d.OutdoorAirTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OutdoorAirTemperature]}}),scale:n}),p("CCV",c)&&(q.CCV={name:"Cooling Coil Valve Position",color:d.CCV,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.CCV]}}),scale:o}),p("HCV",c)&&(q.HCV={name:"Heating Coil Valve Position",color:d.HCV,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HCV]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t()});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function e(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-legend",k=g+" .title",l=g+" .rs-slider";if(document.querySelector(k).innerHTML=e.Title,!p("DischargeAirTemperature",c)&&!p("DischargeAirTemperatureSetPoint",c)&&!p("OutdoorAirTemperature",c))return $(g).find(".rs-chart-area").toggle(),!1;var m=d3.scale.linear().domain([0,200]),n=d3.scale.linear().domain([0,100]),o={};p("OutdoorAirTemperature",c)&&(o.OutdoorAirTemperature={name:"Outdoor Air Temperature",color:d.OutdoorAirTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OutdoorAirTemperature]}}),scale:m}),p("DischargeAirTemperature",c)&&(o.DischargeAirTemperature={name:"Discharge Air Temperature",color:d.DischargeAirTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DischargeAirTemperature]}}),scale:n}),p("DischargeAirTemperatureSetPoint",c)&&(o.DischargeAirTemperatureSetPoint={name:"Discharge Air Temperature Set Point",color:d.DischargeAirTemperatureSetPoint,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DischargeAirTemperatureSetPoint]}}),scale:n});var q=[];angular.forEach(o,function(a,b){q.push(a)});var r=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:q,interpolation:"linear"});r.render();var s=new Rickshaw.Graph.Legend({graph:r,element:document.querySelector(j)}),u=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:r,legend:s}),new Rickshaw.Graph.Axis.ExtendedTime({graph:r,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));u.render();var v=new Rickshaw.Graph.Axis.Y.Scaled({graph:r,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:m,label:t()});v.render();new Rickshaw.Graph.RangeSlider.Preview({graph:r,element:document.querySelector(l)})}function f(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!(p("SupplyFanSpeed",c)||p("SupplyFanStatus",c)||p("DuctStaticPressure",c)||p("ReturnFanSpeed",c)))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,200]),o=d3.scale.linear().domain([0,100]),q={};p("DuctStaticPressure",c)&&(q.DuctStaticPressure={name:"Duct Static Pressure",color:d.DuctStaticPressure,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.DuctStaticPressure]}}),scale:n}),p("SupplyFanSpeed",c)&&(q.SupplyFanSpeed={name:"Supply Fan Speed",color:d.SupplyFanSpeed,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.SupplyFanSpeed]}}),scale:o}),p("SupplyFanStatus",c)&&(q.SupplyFanStatus={name:"Supply Fan Status",color:d.SupplyFanStatus,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.SupplyFanStatus]}}),scale:o}),p("ReturnFanSpeed",c)&&(q.ReturnFanSpeed={name:"Return Fan Speed",color:d.ReturnFanSpeed,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.ReturnFanSpeed]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t("Pressure")});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function g(a,b,c,d,e){var f=e.Container,g=f+" .rs-chart",h=f+" .rs-y-axis",i=f+" .rs-legend",j=f+" .title";if(document.querySelector(j).innerHTML=e.Title,!p("OutdoorAirTemperature",c)||!p("OutdoorDamper",c))return $(f).find(".rs-chart-area").toggle(),!1;a.sort(function(a,b){return a[c.OutdoorAirTemperature]<b[c.OutdoorAirTemperature]?-1:a[c.OutdoorAirTemperature]>b[c.OutdoorAirTemperature]?1:0});var k={};p("OutdoorDamper",c)&&(k.OutdoorDamper={name:"Outdoor Damper Signal",xName:c.OutdoorAirTemperature,color:d.OutdoorDamper,data:a.map(function(a){return{x:a[c.OutdoorAirTemperature],y:a[c.OutdoorDamper]}})});var l=new Rickshaw.Graph({element:document.querySelector(g),renderer:"scatterplot",series:[k.OutdoorDamper]});l.renderer.dotSize=2,l.render();var m=new Rickshaw.Graph.Legend({graph:l,element:document.querySelector(i)}),n=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Axis.X({graph:l,label:s("Outdoor Temperature")}));n.render();var o=new Rickshaw.Graph.Axis.Y({graph:l,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(h),label:t("Outdoor Damper Position")});o.render()}function h(a,b,c,d,e){var f=e.Container,g=f+" .rs-chart",h=f+" .rs-y-axis",i=f+" .rs-legend",j=f+" .title";if(document.querySelector(j).innerHTML=e.Title,!p("SupplyFanSpeed",c)||!p("ReturnFanSpeed",c))return $(f).find(".rs-chart-area").toggle(),!1;a.sort(function(a,b){return a[c.ReturnFanSpeed]<b[c.ReturnFanSpeed]?-1:a[c.ReturnFanSpeed]>b[c.ReturnFanSpeed]?1:0});var k={};p("SupplyFanSpeed",c)&&(k.SupplyFanSpeed={name:"Supply Fan Speed",xName:c.ReturnFanSpeed,color:d.SupplyFanSpeed,data:a.map(function(a){return{x:a[c.ReturnFanSpeed],y:a[c.SupplyFanSpeed]}})});var l=new Rickshaw.Graph({element:document.querySelector(g),renderer:"scatterplot",series:[k.SupplyFanSpeed]});l.renderer.dotSize=2,l.render();var m=new Rickshaw.Graph.Legend({graph:l,element:document.querySelector(i)}),n=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Axis.X({graph:l,label:s("Return Fan Speed")}));n.render();var o=new Rickshaw.Graph.Axis.Y({graph:l,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(h),label:t("Supply Fan Speed")});o.render()}function i(a,b,c,d,e){var f=e.Container,g=f+" .rs-chart",h=f+" .rs-y-axis",i=f+" .rs-legend",j=f+" .title";if(document.querySelector(j).innerHTML=e.Title,!p("HCV",c)||!p("CCV",c))return $(f).find(".rs-chart-area").toggle(),!1;a.sort(function(a,b){return a[c.CCV]<b[c.CCV]?-1:a[c.CCV]>b[c.CCV]?1:0});var k={};p("HCV",c)&&(k.HCV={name:"Heating Coil Valve Position",xName:c.CCV,color:d.HCV,data:a.map(function(a){return{x:a[c.CCV],y:a[c.HCV]}})});var l=new Rickshaw.Graph({element:document.querySelector(g),renderer:"scatterplot",series:[k.HCV]});l.renderer.dotSize=2,l.render();var m=new Rickshaw.Graph.Legend({graph:l,element:document.querySelector(i)}),n=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Axis.X({graph:l,label:s("Cooling Coil Valve")}));n.render();var o=new Rickshaw.Graph.Axis.Y({graph:l,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(h),label:t("Heating Coil Valve")});o.render()}function j(a,b,c,d,e){var f=e.Container,g=f+" .rs-chart",h=f+" .rs-y-axis",i=f+" .rs-legend",j=f+" .title";if(document.querySelector(j).innerHTML=e.Title,!p("DischargeAirTemperatureSetPoint",c)||!p("DischargeAirTemperature",c))return $(f).find(".rs-chart-area").toggle(),!1;a.sort(function(a,b){return a[c.DischargeAirTemperatureSetPoint]<b[c.DischargeAirTemperatureSetPoint]?-1:a[c.DischargeAirTemperatureSetPoint]>b[c.DischargeAirTemperatureSetPoint]?1:0});var k={};p("DischargeAirTemperature",c)&&(k.DischargeAirTemperature={name:"Discharge Air Temperature",xName:c.DischargeAirTemperatureSetPoint,color:d.DischargeAirTemperature,data:a.map(function(a){return{x:a[c.DischargeAirTemperatureSetPoint],y:a[c.DischargeAirTemperature]}})});var l=new Rickshaw.Graph({element:document.querySelector(g),renderer:"scatterplot",series:[k.DischargeAirTemperature]});l.renderer.dotSize=2,l.render();var m=new Rickshaw.Graph.Legend({graph:l,element:document.querySelector(i)}),n=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Axis.X({graph:l,label:s("Discharge Temperature SetPoint")}));n.render();var o=new Rickshaw.Graph.Axis.Y({graph:l,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(h),label:t("Discharge Temperature")});o.render()}var k="datetime",l={OutdoorAirTemperature:"OutdoorAirTemperature",MixedAirTemperature:"MixedAirTemperature",ReturnAirTemperature:"ReturnAirTemperature",DischargeAirTemperature:"DischargeAirTemperature",DischargeAirTemperatureSetPoint:"DischargeAirTemperatureSetPoint",SupplyFanStatus:"SupplyFanStatus",SupplyFanSpeed:"SupplyFanSpeed",OutdoorDamper:"OutdoorDamper",CCV:"CCV",HCV:"HCV",OutdoorAirFraction:"OutdoorAirFraction",ReturnFanSpeed:"ReturnFanSpeed",OccupancyMode:"OccupancyMode",DuctStaticPressure:"DuctStaticPressure",DuctStaticPressureSetPoint:"DuctStaticPressureSetPoint"};counts={},points={};for(var n in l)counts[n]=0,points[n]=l[n];var o={OutdoorAirTemperature:"blue",MixedAirTemperature:"LightPink",ReturnAirTemperature:"HotPink",DischargeAirTemperature:"Gainsboro",DischargeAirTemperatureSetPoint:"DarkKhaki",SupplyFanStatus:"BurlyWood",SupplyFanSpeed:"Chocolate",OutdoorDamper:"blueviolet",CCV:"Green",HCV:"Red",OutdoorAirFraction:"DarkBlue",ReturnFanSpeed:"CadetBlue",OccupancyMode:"Brown",DuctStaticPressure:"Magenta",DuctStaticPressureSetPoint:"DarkMagenta"},q="FTimestamp";a.forEach(function(a){var b=a[k].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[q]=b,v(a,points,counts)});for(var n in counts)0==counts[n]&&delete points[n];var r=m(a[0][q],a[a.length-1][q],[a[0][q],a[1][q],a[2][q]]),w={Timestamp:q,Title:"AHU Economizer Response Analysis",Container:"#oa-chart-box1",TimeUnit:r};b(a,l,points,o,w);var x={Timestamp:q,Title:"AHU Discharge Static Pressure Control Performance Analysis",Container:"#sp-chart-box1"};c(a,l,points,o,x);var x={Timestamp:q,Title:"AHU Simultaneous Heating and Cooling Performance Analysis",Container:"#coil-chart-box1"};d(a,l,points,o,x);var x={Timestamp:q,Title:"Discharge Air Temperature Set Point Performance Analysis",Container:"#discharge-chart-box1"};e(a,l,points,o,x);var x={Timestamp:q,Title:"AHU Operational Day, Night and Weekend Operations Analysis",Container:"#fan-chart-box1"};f(a,l,points,o,x);var x={Timestamp:q,Title:"Seasonal AHU Economizer Damper Command Response Analysis",Container:"#oa-chart-box2"};g(a,l,points,o,x);var x={Timestamp:q,Title:"AHU VFD-Driven Fan Tracking (Supply and Return) Performance Analysis",Container:"#sp-chart-box2"};h(a,l,points,o,x);var x={Timestamp:q,Title:"AHU Heating and Cooling Coil Performance Analysis",Container:"#coil-chart-box2"};i(a,l,points,o,x);var x={Timestamp:q,Title:"Discharge Air Temperature Control Performance Analysis",Container:"#discharge-chart-box2"};j(a,l,points,o,x),$(".rs-chart-container.hidden").removeClass("hidden")}function A(a){function b(a,b,c,d,f){var g=f.TimeUnit,h=f.Container,i=h+" .rs-chart",j=h+" .rs-y-axis",k=h+" .rs-y-axis2",l=h+" .rs-legend",m=h+" .title",n=h+" .rs-slider";if(document.querySelector(m).innerHTML=f.Title,!r(e.ZoneTemp,c))return $(h).find(".rs-chart-area").toggle(),!1;var o=d3.scale.linear().domain([0,200]),p=d3.scale.linear().domain([0,100]),s={};for(var v in c)(q(v,e.ZoneTemp)||q(v,e.ZoneSetPoint))&&(s[v]={name:v.replace(/^Zone/,"").replace(/^TerminalBox/,""),color:d[v],data:a.map(function(a){return{x:a[f.Timestamp],y:a[v]}}),scale:o}),(q(v,e.ZoneRhtVlvSignal)||q(v,e.ZoneDamperPos)||q(v,e.ZoneOcc)||q(v,e.ZoneFanStatus)||q(v,e.ZoneCFM))&&(s[v]={name:v.replace(/^Zone/,"").replace(/^TerminalBox/,""),color:d[v],data:a.map(function(a){return{x:a[f.Timestamp],y:a[v]}}),scale:p});var w=[];angular.forEach(s,function(a,b){w.push(a)});var x=new Rickshaw.Graph({element:document.querySelector(i),renderer:"line",series:w,interpolation:"linear"});x.render();var y=new Rickshaw.Graph.Legend({graph:x,element:document.querySelector(l)}),z=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:x,legend:y}),new Rickshaw.Graph.Axis.ExtendedTime({graph:x,orientation:"bottom",
pixelsPerTick:50,tickSpacing:21600,timeUnit:g}));z.render();var A=new Rickshaw.Graph.Axis.Y.Scaled({graph:x,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,label:t("Temperature")});A.render();var B=new Rickshaw.Graph.Axis.Y.Scaled({graph:x,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(k),scale:p,ticks:5,label:u("Command Signal")});B.render();new Rickshaw.Graph.RangeSlider.Preview({graph:x,element:document.querySelector(n)})}var c="datetime",e={ZoneTemp:"ZoneTemperature",ZoneRhtVlvSignal:"TerminalBoxReheatValvePosition",ZoneDamperPos:"TerminalBoxDamperCommand",ZoneOcc:"ZoneOccupancyMode",ZoneFanStatus:"ZoneFanStatus",ZoneSetPoint:"ZoneTemperatureSetPoint",ZoneCFM:"TerminalBoxFanAirflow"},f={};if(a.length>0){d=a[0];for(var g in d)if(d.hasOwnProperty(g))for(var h in e)e.hasOwnProperty(h)&&q(g,e[h])&&(f[g]=g)}var i={},j={};for(var k in f)i[k]=0,j[k]=f[k];var l={},n=0;for(var h in j)l[h]=x(n++);var o="FTimestamp";a.forEach(function(a){var b=a[c].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[o]=b,v(a,j,i)});for(var k in i)0==i[k]&&delete j[k];var p=m(a[0][o],a[a.length-1][o],[a[0][o],a[1][o],a[2][o]]),s={Timestamp:o,Title:"Zone Terminal Box Performance Analysis",Container:"#temps-chart-box",TimeUnit:p};b(a,f,j,l,s),$(".rs-chart-container.hidden").removeClass("hidden")}function B(a){function b(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-legend",k=g+" .title",l=g+" .rs-slider";if(document.querySelector(k).innerHTML=e.Title,!p("HotWaterSupplyTemperature",c))return $(g).find(".rs-chart-area").toggle(),!1;var m=d3.scale.linear().domain([0,200]),n=(d3.scale.linear().domain([0,100]),{});p("HotWaterSupplyTemperature",c)&&(n.HotWaterSupplyTemperature={name:"Hot Water Supply Temperature",color:d.HotWaterSupplyTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HotWaterSupplyTemperature]}}),scale:m}),p("HotWaterReturnTemperature",c)&&(n.HotWaterReturnTemperature={name:c.HotWaterReturnTemperature,color:d.HotWaterReturnTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HotWaterReturnTemperature]}}),scale:m},n.HotWaterDeltaT={name:"HotWaterDeltaT",color:d.HotWaterDeltaT,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HotWaterSupplyTemperature]-a[c.HotWaterReturnTemperature]}}),scale:m}),p("HotWaterTemperatureSetPoint",c)&&(n.HotWaterTemperatureSetPoint={name:"Hot Water Temperature Set Point",color:d.HotWaterTemperatureSetPoint,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HotWaterTemperatureSetPoint]}}),scale:m}),p("OutdoorAirTemperature",c)&&(n.OutdoorAirTemperature={name:"Outdoor Air Temperature",color:d.OutdoorAirTemperature,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.OutdoorAirTemperature]}}),scale:m}),p("ZoneSetPoint",c)&&(n.ZoneSetPoint={name:"Zone Temperature Set Point",color:d.ZoneSetPoint,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.ZoneSetPoint]}}),scale:m});var o=[];angular.forEach(n,function(a,b){o.push(a)});var q=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:o,interpolation:"linear"});q.render();var r=new Rickshaw.Graph.Legend({graph:q,element:document.querySelector(j)}),s=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:q,legend:r}),new Rickshaw.Graph.Axis.ExtendedTime({graph:q,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));s.render();var u=new Rickshaw.Graph.Axis.Y.Scaled({graph:q,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:m,label:t("Temperature")});u.render();new Rickshaw.Graph.RangeSlider.Preview({graph:q,element:document.querySelector(l)})}function c(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("LoopDifferentialPressure",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([0,200]),o=d3.scale.linear().domain([0,100]),q={};p("LoopDifferentialPressure",c)&&(q.LoopDifferentialPressure={name:"Loop Differential Pressure",color:d.LoopDifferentialPressure,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.LoopDifferentialPressure]}}),scale:n}),p("LoopDifferentialPressureSetPoint",c)&&(q.LoopDifferentialPressureSetPoint={name:"Loop Differential Pressure SetPoint",color:d.LoopDifferentialPressureSetPoint,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.LoopDifferentialPressureSetPoint]}}),scale:n}),p("HotWaterPumpVfd",c)&&(q.HotWaterPumpVfd={name:"Hot Water Pump Vfd",color:d.HotWaterPumpVfd,data:a.map(function(a){return{x:a[e.Timestamp],y:a[c.HotWaterPumpVfd]}}),scale:o});var r=[];angular.forEach(q,function(a,b){r.push(a)});var s=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:r,interpolation:"linear"});s.render();var v=new Rickshaw.Graph.Legend({graph:s,element:document.querySelector(k)}),w=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:s,legend:v}),new Rickshaw.Graph.Axis.ExtendedTime({graph:s,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));w.render();var x=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t("Pressure")});x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:s,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u("Command Signal")});y.render();new Rickshaw.Graph.RangeSlider.Preview({graph:s,element:document.querySelector(m)})}function d(a,b,c,d,e){var f=e.Container,g=f+" .rs-chart",h=f+" .rs-y-axis",i=f+" .rs-legend",j=f+" .title";if(document.querySelector(j).innerHTML=e.Title,!p("HotWaterSupplyTemperature",c)||!p("OutdoorAirTemperature",c))return $(f).find(".rs-chart-area").toggle(),!1;a.sort(function(a,b){return a[c.OutdoorAirTemperature]<b[c.OutdoorAirTemperature]?-1:a[c.OutdoorAirTemperature]>b[c.OutdoorAirTemperature]?1:0});var k={};p("HotWaterSupplyTemperature",c)&&(k.HotWaterSupplyTemperature={name:"Hot Water Supply Temperature",xName:c.OutdoorAirTemperature,color:d.HotWaterSupplyTemperature,data:a.map(function(a){return{x:a[c.OutdoorAirTemperature],y:a[c.HotWaterSupplyTemperature]}})});var l=new Rickshaw.Graph({element:document.querySelector(g),renderer:"scatterplot",series:[k.HotWaterSupplyTemperature]});l.renderer.dotSize=2,l.render();var m=new Rickshaw.Graph.Legend({graph:l,element:document.querySelector(i)}),n=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:l,legend:m}),new Rickshaw.Graph.Axis.X({graph:l,label:s("Outdoor Air Temperature")}));n.render();var o=new Rickshaw.Graph.Axis.Y({graph:l,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(h),label:t("Hot Water Supply Temperature")});o.render()}var e="datetime",f={OutdoorAirTemperature:"OutdoorAirTemperature",LoopDifferentialPressure:"LoopDifferentialPressure",LoopDifferentialPressureSetPoint:"LoopDifferentialPressureSetPoint",PumpStatus:"PumpStatus",BoilerStatus:"BoilerStatus",HotWaterPumpVfd:"HotWaterPumpVfd",HotWaterSupplyTemperature:"HotWaterSupplyTemperature",HotWaterTemperatureSetPoint:"HotWaterTemperatureSetPoint",HotWaterReturnTemperature:"HotWaterReturnTemperature"};counts={},points={};for(var g in f)counts[g]=0,points[g]=f[g];var h={OutdoorAirTemperature:"blue",HotWaterTemperatureSetPoint:"HotPink",HotWaterReturnTemperature:"LightPink",HotWaterSupplyTemperature:"Red",LoopDifferentialPressure:"DarkMagenta",LoopDifferentialPressureSetPoint:"Magenta",PumpStatus:"Chocolate",BoilerStatus:"blueviolet",HotWaterPumpVfd:"Green",HotWaterDeltaT:"Brown"},i="FTimestamp";a.forEach(function(a){var b=a[e].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[i]=b,v(a,points,counts)});for(var g in counts)0==counts[g]&&delete points[g];var j=m(a[0][i],a[a.length-1][i],[a[0][i],a[1][i],a[2][i]]),k={Timestamp:i,Title:"Hot Water Plant Set Point Performance Analysis",Container:"#temp-box",TimeUnit:j};b(a,f,points,h,k);var l={Timestamp:i,Title:"Hot Water Plant Loop Differential Pressure Set Point Performance Analysis",Container:"#pressure-box",TimeUnit:j};c(a,f,points,h,l);var l={Timestamp:i,Title:"Seasonal Hot Water Temperature Response Analysis",Container:"#hws-oat-box"};d(a,f,points,h,l),$(".rs-chart-container.hidden").removeClass("hidden")}function C(a){function b(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("ZoneTemperature",c))return $(g).find(".rs-chart-area").toggle(),!1;var o=d3.scale.linear().domain([60,80]),q=d3.scale.linear().domain([0,5]),r={},s=a.filter(function(a){return"data"==a.type?!0:!1});p("ZoneTemperature",c)&&(r.ZoneTemperature={name:"Zone Temperature",color:d.ZoneTemperature,renderer:"line",interpolation:"linear",data:s.map(function(a){return{x:a[e.Timestamp],y:a[c.ZoneTemperature]}}),scale:o}),p("FanStatus",c)&&(r.FanStatus={name:"Fan Status",color:d.FanStatus,renderer:"bar",data:s.map(function(a){return{x:a[e.Timestamp],y:a[c.FanStatus]}}),scale:q}),p("ZoneTemperatureSetPoint",c)&&(setpoints=a.filter(function(a){return"setpoint"==a.type?!0:!1}),numSetpoints=setpoints.length,numSetpoints>0&&(setpoints.sort(function(a,b){return a[e.Timestamp]-b[e.Timestamp]}),setpoints_viz=s.map(function(a){for(n=0;n<numSetpoints&&!(a[e.Timestamp]<setpoints[n][e.Timestamp]);n++);return n>=numSetpoints&&(n=numSetpoints-1),{x:a[e.Timestamp],y:setpoints[n][c.ZoneTemperatureSetPoint]}}),r.ZoneTemperatureSetPoint={name:"Zone Temperature Set Point",color:d.ZoneTemperatureSetPoint,renderer:"line",interpolation:"step-after",data:setpoints_viz,scale:o}));var v=[];angular.forEach(r,function(a,b){v.push(a)});var w=new Rickshaw.Graph({element:document.querySelector(h),series:v,renderer:"multi"});w.render();var x=new Rickshaw.Graph.Legend({graph:w,element:document.querySelector(k)}),y=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:w,legend:x}),new Rickshaw.Graph.Axis.ExtendedTime({graph:w,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));y.render();var z=new Rickshaw.Graph.Axis.Y.Scaled({graph:w,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:o,label:t()});z.render();var A=new Rickshaw.Graph.Axis.Y.Scaled({graph:w,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:q,ticks:5,label:u()});A.render();new Rickshaw.Graph.RangeSlider.Preview({graph:w,element:document.querySelector(m)})}var c="datetime",e={ZoneTemperature:"ZoneTemperature",ZoneTemperatureSetPoint:"ZoneTemperatureSetPoint",FanStatus:"FanStatus"},f={};if(a.length>0){d=a[0];for(var g in d)if(d.hasOwnProperty(g))for(var h in e)e.hasOwnProperty(h)&&g==e[h]&&(f[g]=g)}var i={},j={};for(var k in f)i[k]=0,j[k]=f[k];var l={},n=0;for(var h in j)l[h]=x(n++);var o="FTimestamp";a.forEach(function(a){var b=a[c].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[o]=b,v(a,j,i)});for(var k in i)0==i[k]&&delete j[k];var q=m(a[0][o],a[a.length-1][o],[a[0][o],a[1][o],a[2][o]]),r={Timestamp:o,Title:"Temperature Set Point Detection",Container:"#temps-chart-box",TimeUnit:q};b(a,f,j,l,r),$(".rs-chart-container.hidden").removeClass("hidden")}function D(a,b,c){var d=a.filter(function(a){return a[c]>-9999?!0:!1}).map(function(a){return{x:a[b],y:a[c]}});return d}function E(a){function b(a,b,c,d,e){var f=e.TimeUnit,g=e.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-y-axis2",k=g+" .rs-legend",l=g+" .title",m=g+" .rs-slider";if(document.querySelector(l).innerHTML=e.Title,!p("ZoneTemperature",c)&&!p("FanStatus",c))return $(g).find(".rs-chart-area").toggle(),!1;var n=d3.scale.linear().domain([60,80]),o=d3.scale.linear().domain([0,15]),q={};if(p("ZoneTemperature",c)){var r=D(a,e.Timestamp,c.ZoneTemperature);r.length>0&&(q.ZoneTemperature={name:"Zone Temperature",color:d.ZoneTemperature,renderer:"line",interpolation:"linear",data:r,scale:n})}if(p("FanStatus",c)){var r=D(a,e.Timestamp,c.FanStatus);r.length>0&&(q.FanStatus={name:"Fan Status",color:d.FanStatus,renderer:"line",interpolation:"step-after",data:r,scale:o})}if(p("ZoneTemperatureSetPoint",c)){var r=D(a,e.Timestamp,c.ZoneTemperatureSetPoint);r.length>0&&(q.ZoneTemperatureSetPoint={name:"Zone Temperature SetPoint",color:d.ZoneTemperatureSetPoint,renderer:"line",interpolation:"linear",data:r,scale:n})}if(p("ComprStatus",c)){var r=D(a,e.Timestamp,c.ComprStatus);r.length>0&&(q.ComprStatus={name:"Compressor Status",color:d.ComprStatus,renderer:"bar",data:r,scale:o})}if(p("cycling",c)){var r=D(a,e.Timestamp,c.cycling);r.length>0&&(q.cycling={name:"Cycling",color:d.cycling,renderer:"bar",data:r,scale:o})}var s=[];angular.forEach(q,function(a,b){s.push(a)});var v=new Rickshaw.Graph({element:document.querySelector(h),series:s,renderer:"multi"});v.render();var w=new Rickshaw.Graph.Legend({graph:v,element:document.querySelector(k)}),x=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:v,legend:w}),new Rickshaw.Graph.Axis.ExtendedTime({graph:v,orientation:"bottom",pixelsPerTick:50,tickSpacing:21600,timeUnit:f}));x.render();var y=new Rickshaw.Graph.Axis.Y.Scaled({graph:v,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),scale:n,label:t()});y.render();var z=new Rickshaw.Graph.Axis.Y.Scaled({graph:v,berthRate:0,orientation:"right",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(j),scale:o,ticks:5,label:u()});z.render();new Rickshaw.Graph.RangeSlider.Preview({graph:v,element:document.querySelector(m)})}var c="datetime",e={ZoneTemperature:"ZoneTemperature",ZoneTemperatureSetPoint:"ZoneTemperatureSetPoint",FanStatus:"FanStatus",ComprStatus:"ComprStatus",cycling:"cycling"},f={};if(a.length>0){d=a[0];for(var g in d)if(d.hasOwnProperty(g))for(var h in e)e.hasOwnProperty(h)&&g==e[h]&&(f[g]=g)}var i={},j={};for(var k in f)i[k]=0,j[k]=f[k];var l={},n=0;for(var h in j)l[h]=x(n++);var o="FTimestamp";a.forEach(function(a){var b=a[c].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[o]=b,v(a,j,i)});for(var k in i)0==i[k]&&delete j[k];var q=m(a[0][o],a[a.length-1][o],[a[0][o],a[1][o],a[2][o]]),r={Timestamp:o,Title:"Compressor Cycling Diagnostics",Container:"#temps-chart-box",TimeUnit:q};b(a,f,j,l,r),$(".rs-chart-container.hidden").removeClass("hidden")}function F(a){function b(a,b,c,d,e,f,g,h,i){var j=d.Container,k=j+" .rs-chart",l=j+" .rs-y-axis",m=j+" .rs-legend",n=j+" .title";if(document.querySelector(n).innerHTML=d.Title,!p("Load",b))return $(j).find(".rs-chart-area").toggle(),!1;var o={};o.DailyLoad={name:"Daily Load",xName:"Hour",color:c[0],data:e.map(function(a){return{x:a.Hour,y:a[b.Load]}})},o.WeekdayLoad={name:"Weekday Load",xName:"Hour",color:c[1],data:f.map(function(a){return{x:a.Hour,y:a[b.Load]}})},o.SaturdayLoad={name:"Saturday Load",xName:"Hour",color:c[2],data:g.map(function(a){return{x:a.Hour,y:a[b.Load]}})},o.SundayLoad={name:"Sunday Load",xName:"Hour",color:c[3],data:h.map(function(a){return{x:a.Hour,y:a[b.Load]}})},o.HolidayLoad={name:"Holiday Load",xName:"Hour",color:c[4],data:i.map(function(a){return{x:a.Hour,y:a[b.Load]}})};var q=new Rickshaw.Graph({element:document.querySelector(k),renderer:"line",series:[o.DailyLoad,o.WeekdayLoad,o.SaturdayLoad,o.SundayLoad,o.HolidayLoad]});q.renderer.dotSize=2,q.render();var r=new Rickshaw.Graph.Legend({graph:q,element:document.querySelector(m)}),u=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:q,legend:r}),new Rickshaw.Graph.Axis.X({graph:q,label:s("Hour")}));u.render();var v=new Rickshaw.Graph.Axis.Y({graph:q,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(l),label:t("Energy (kWh)")});v.render()}var c="datetime",d={Load:"load"},e={},f={};for(var g in d)e[g]=0,f[g]=d[g];var h={},i=0;for(i=0;5>i;i++)h[i]=x(i);var j="FTimestamp";a.forEach(function(a){var b=a[c].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[j]=b,v(a,f,e)});for(var g in e)0==e[g]&&delete f[g];var k={Timestamp:j,Title:"Daily Load Profile - All Days",Container:"#loadprofile-chart-box"},l=H(a,"A"),m=H(a,"W"),n=H(a,"Sat"),o=H(a,"Sun"),q=H(a,"H");b(d,f,h,k,l,m,n,o,q),$(".rs-chart-container.hidden").removeClass("hidden")}function G(a){function b(a,b,c,d,e,f){var g=d.Container,h=g+" .rs-chart",i=g+" .rs-y-axis",j=g+" .rs-legend",k=g+" .title";if(document.querySelector(k).innerHTML=d.Title,!p("Load",b))return $(g).find(".rs-chart-area").toggle(),!1;var l={};l.PreLoad={name:"Pre Rx Load",xName:"Hour",color:c[0],data:e.map(function(a){return{x:a.Hour,y:a[b.Load]}})},l.PostLoad={name:"Post Rx Load",xName:"Hour",color:c[1],data:f.map(function(a){return{x:a.Hour,y:a[b.Load]}})};var m=new Rickshaw.Graph({element:document.querySelector(h),renderer:"line",series:[l.PreLoad,l.PostLoad]});m.renderer.dotSize=2,m.render();var n=new Rickshaw.Graph.Legend({graph:m,element:document.querySelector(j)}),o=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:m,legend:n}),new Rickshaw.Graph.Axis.X({graph:m,label:s("Hour")}));o.render();var q=new Rickshaw.Graph.Axis.Y({graph:m,berthRate:0,orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT,element:document.querySelector(i),label:t("Energy (kWh)")});q.render()}var c="datetime",d={Load:"load"},e={},f={};for(var g in d)e[g]=0,f[g]=d[g];var h={},i=0;for(i=0;5>i;i++)h[i]=x(i);var j="FTimestamp";a.forEach(function(a){var b=a[c].split("+")[0];b=b.replace(" ","T"),b=Date.parse(b)/1e3,a[j]=b,v(a,f,e)});for(var g in e)0==e[g]&&delete f[g];var k={Timestamp:j,Title:"Daily Load Profile - All Days",Container:"#loadprofile-alldays-chart-box"},l={Timestamp:j,Title:"Daily Load Profile - Week Days",Container:"#loadprofile-weekdays-chart-box"},m={Timestamp:j,Title:"Daily Load Profile - Saturday",Container:"#loadprofile-sat-chart-box"},n={Timestamp:j,Title:"Daily Load Profile - Sunday",Container:"#loadprofile-sun-chart-box"},o={Timestamp:j,Title:"Daily Load Profile - Holidays",Container:"#loadprofile-holidays-chart-box"},q=I(a,"A","pre"),r=I(a,"W","pre"),u=I(a,"Sat","pre"),w=I(a,"Sun","pre"),y=I(a,"H","pre"),z=I(a,"A","post"),A=I(a,"W","post"),B=I(a,"Sat","post"),C=I(a,"Sun","post"),D=I(a,"H","post");b(d,f,h,k,q,z),b(d,f,h,l,r,A),b(d,f,h,m,u,B),b(d,f,h,n,w,C),b(d,f,h,o,y,D),$(".rs-chart-container.hidden").removeClass("hidden")}function H(a,b){for(sums=[],counts=[],avgs=[],result=[],i=0;i<24;i++)sums[i]=0,counts[i]=0,avgs[i]=0;for(a.forEach(function(a){if("A"==b||a.daytype==b){var c=w(a.datetime),d=(h(c),c.getHours());sums[d]+=a.load,counts[d]+=1}}),i=0;i<24;i++)counts[i]>0&&(avgs[i]=sums[i]/counts[i]),result.push({Hour:i,load:avgs[i]});return result}function I(a,b,c){for(sums=[],counts=[],avgs=[],result=[],i=0;i<24;i++)sums[i]=0,counts[i]=0,avgs[i]=0;for(a.forEach(function(a){if(("A"==b||a.daytype==b)&&a.rxtype==c){var d=w(a.datetime),e=(h(d),d.getHours());sums[e]+=a.load,counts[e]+=1}}),i=0;i<24;i++)counts[i]>0&&(avgs[i]=sums[i]/counts[i]),result.push({Hour:i,load:avgs[i]});return result}return{restrict:"E",terminal:!0,transclude:!0,scope:{arReport:"=",arData:"="},link:function(d,h,i){d.arReport.description&&h.append("<p>"+d.arReport.description+"</p>"),angular.forEach(d.arReport.elements,function(i){switch(i.title&&h.append("<h1>"+i.title+"</h1>"),i.type){case"Table":var j=angular.element("<table><thead><tr/></thead><tbody/></table>"),k=j.find("tbody");angular.forEach(i.column_info,function(a){j.find("tr").append("<th>"+a[1]+"</th>")}),angular.forEach(d.arData[i.table_name],function(a){var b=angular.element("<tr/>");angular.forEach(i.column_info,function(c){b.append("<td>"+a[c[0]]+"</td>")}),k.append(b)}),h.append(j);break;case"TextBlurb":h.append('<p class="text-blurb">'+i.text+"</p>");break;case"LinePlot":angular.forEach(i.xy_dataset_list,function(a){var c=[];angular.forEach(d.arData[a.table_name],function(b){c.push({x:b[a.x_column],y:b[a.y_column]})}),h.append(angular.element('<div class="line-plot" />').append(b(c,i.x_label,i.y_label)))});break;case"BarChart":angular.forEach(i.xy_dataset_list,function(a){var b=[];angular.forEach(d.arData[a.table_name],function(c){b.push({x:c[a.x_column],y:c[a.y_column]})}),h.append(angular.element('<div class="bar-chart" />').append(c(b,i.x_label,i.y_label)))});break;case"ScatterPlot":angular.forEach(i.xy_dataset_list,function(a){var b=[];angular.forEach(d.arData[a.table_name],function(c){b.push({x:c[a.x_column],y:c[a.y_column]})}),h.append(angular.element('<div class="scatter-plot" />').append(e(b,i.x_label,i.y_label)))});break;case"DatetimeScatterPlot":angular.forEach(i.xy_dataset_list,function(a){var b=[];angular.forEach(d.arData[a.table_name],function(c){b.push({x:c[a.x_column],y:c[a.y_column]})}),h.append(angular.element('<div class="scatter-plot scatter-plot--datetime" />').append(f(b,i.x_label,i.y_label)))});break;case"HeatMap":var l=[];angular.forEach(d.arData[i.table_name],function(a){l.push({x:a[i.x_column],y:a[i.y_column],z:a[i.z_column]})}),h.append(angular.element('<div class="heat-map" />').append(g(l,i.x_label,i.y_label)));break;case"RetroCommissioningAFDD":h.append(angular.element('<div class="retro-commissioning-afdd" />').append(o(d.arData[i.table_name],0)));break;case"SetpointDetector":h.append(angular.element('<div class="setpoint-detector" />').html("<div id='temps-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>")),C(d.arData[i.table_name],0);break;case"CyclingDetector":h.append(angular.element('<div class="cycling-detector" />').html("<div id='temps-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>")),E(d.arData[i.table_name],0);break;case"LoadProfile":h.append(angular.element('<div class="load-profile" />').html("<div id='loadprofile-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>")),F(d.arData[i.table_name],0);break;case"LoadProfileRx":h.append(angular.element('<div class="load-profile-rx" />').html("<div id='loadprofile-alldays-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='loadprofile-weekdays-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='loadprofile-sat-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='loadprofile-sun-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='loadprofile-holidays-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>")),G(d.arData[i.table_name],0);break;case"RxStaticPressure":h.append(angular.element('<div class="retro-commissioning-afdd" />').append(o(d.arData[i.table_name],1)));break;case"RxSupplyTemp":h.append(angular.element('<div class="retro-commissioning-afdd" />').append(o(d.arData[i.table_name],2)));break;case"RxOperationSchedule":h.append(angular.element('<div class="retro-commissioning-afdd" />').append(o(d.arData[i.table_name],3)));break;case"RetroCommissioningAFDDEcam":var m=angular.element("<div id='result' class='result' />"),n=angular.element("                        <ul class='nav nav-tabs'>                            <li heading='data' id='data' class='active' style=''>                                <a href=''>data</a>                            </li>                            <li heading='analysis' id='analysis' class='' style=''>                                <a href=''>analysis</a>                            </li>                        </ul>"),p=angular.element("<div class='tab-content'></div>"),q=angular.element("                        <div id='data-content' class='tab-pane active' style=''>                            <div id='ecam' class='ecam' />                                <div id='temps-chart-box' class='rs-chart-container hidden'>                                    <div class='title noselect'></div>                                    <div class='rs-chart-area time-series'>                                      <div class='rs-y-axis'></div>                                      <div class='rs-chart'></div>                                      <div class='rs-y-axis2'></div>                                      <div class='rs-legend'></div>                                      <div class='rs-slider'></div>                                    </div>                                </div>                                <div id='hcv-box' class='rs-chart-container hidden'>                                        <div class='title noselect'></div>                                        <div class='rs-chart-area time-series'>                                            <div class='rs-y-axis'></div>                                            <div class='rs-chart'></div>                                            <div class='rs-y-axis2'></div>                                            <div class='rs-legend'></div>                                            <div class='rs-slider'></div>                                        </div>                                </div>                                <div id='mat-oat-box' class='rs-chart-container hidden'>                                        <div class='title noselect'></div>                                        <div class='rs-chart-area'>                                            <div class='rs-y-axis'></div>                                            <div class='rs-chart'></div>                                            <div class='rs-legend'></div>                                        </div>                                </div>                            </div>                        </div>"),r=angular.element("<div id='analysis-content' class='tab-pane' style=''></div>"),s=angular.element("<div class='retro-commissioning-afdd' />").append(o(d.arData[i.table_name],0));r.append(s),p.append(q),p.append(r),m.append(n),m.append(p),h.append(m),y(d.arData[i.table_name]),a(h.contents())(d);break;case"AhuEcam":h.append(angular.element('<div class="ecam" />').html("<div id='oa-chart-box1' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='oa-chart-box2' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='sp-chart-box1' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='sp-chart-box2' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='coil-chart-box1' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='coil-chart-box2' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='discharge-chart-box1' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='discharge-chart-box2' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>                          <div id='fan-chart-box1' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>")),
z(d.arData[i.table_name]);break;case"ZoneEcam":h.append(angular.element('<div class="ecam" />').html("<div id='temps-chart-box' class='rs-chart-container hidden'>                            <div class='title noselect'></div>                            <div class='rs-chart-area time-series'>                              <div class='rs-y-axis'></div>                              <div class='rs-chart'></div>                              <div class='rs-y-axis2'></div>                              <div class='rs-legend'></div>                              <div class='rs-slider'></div>                            </div>                          </div>")),A(d.arData[i.table_name]);break;case"HWPlantViz":h.append(angular.element('<div class="ecam" />').html("<div id='temp-box' class='rs-chart-container hidden'>                        <div class='title noselect'></div>                        <div class='rs-chart-area time-series'>                          <div class='rs-y-axis'></div>                          <div class='rs-chart'></div>                          <div class='rs-y-axis2'></div>                          <div class='rs-legend'></div>                          <div class='rs-slider'></div>                        </div>                      </div>                      <div id='pressure-box' class='rs-chart-container hidden'>                        <div class='title noselect'></div>                        <div class='rs-chart-area time-series'>                          <div class='rs-y-axis'></div>                          <div class='rs-chart'></div>                          <div class='rs-y-axis2'></div>                          <div class='rs-legend'></div>                          <div class='rs-slider'></div>                        </div>                      </div>                      <div id='hws-oat-box' class='rs-chart-container hidden'>                        <div class='title noselect'></div>                        <div class='rs-chart-area time-series'>                          <div class='rs-y-axis'></div>                          <div class='rs-chart'></div>                          <div class='rs-y-axis2'></div>                          <div class='rs-legend'></div>                          <div class='rs-slider'></div>                        </div>                      </div>")),B(d.arData[i.table_name])}}),$(".rs-chart-container .title").click(function(){var a=$(this).parent().find(".rs-chart-area");a.toggle()}),$("#data").click(function(){$("#data").removeClass("active").addClass("active"),$("#data-content").removeClass("active").addClass("active"),$("#analysis").removeClass("active"),$("#analysis-content").removeClass("active")}),$("#analysis").click(function(){$("#analysis").removeClass("active").addClass("active"),$("#analysis-content").removeClass("active").addClass("active"),$("#data").removeClass("active"),$("#data-content").removeClass("active")})}}}]),angular.module("openeis-ui.directives.file-upload",[]).directive("fileUpload",["$parse",function(a){return{restrict:"E",template:'<input type="file"><button disabled>Upload</button>',compile:function(b,c){return clickFn=a(c.fileUploadClick),function(a,b,c){var d=b.find("input"),e=b.find("button");d.on("change",function(){d[0].files.length?e.prop("disabled",!1):e.prop("disabled",!0)}),e.on("click",function(b){e.prop("disabled",!0),a.$apply(function(){clickFn(a,{$event:b,files:d[0].files})["finally"](function(){d.val("").triggerHandler("change")})})})}}}}]),angular.module("openeis-ui.directives.sensor-container",["RecursionHelper","openeis-ui.components.modals","openeis-ui.filters","openeis-ui.services.data-maps"]).directive("sensorContainer",["RecursionHelper",function(a){return{restrict:"E",scope:{container:"=",files:"=",parent:"="},templateUrl:"sensor-container-directive.tpl.html",controller:["$scope","DataMaps","Modals",function(a,b,c){b.getDefinition().then(function(b){a.definition=b,a.objectDefinition=b[a.container.level],a.objectDefinition.sensor_list&&("*"===a.objectDefinition.sensor_list&&(a.objectDefinition.sensor_list=[],angular.forEach(b.sensors,function(b,c){a.objectDefinition.sensor_list.push(c)})),a.objectDefinition.sensor_list.sort()),a.objectDefinition.attribute_list&&("*"===a.objectDefinition.attribute_list&&(a.objectDefinition.attribute_list=[],angular.forEach(b.attributes,function(b,c){a.objectDefinition.attribute_list.push(c)})),!a.parent.hasOwnProperty("version")&&a.objectDefinition.attribute_list.indexOf("timezone")>-1&&a.objectDefinition.attribute_list.splice(a.objectDefinition.attribute_list.indexOf("timezone"),1),a.objectDefinition.attribute_list.sort())}),b.getUnits().then(function(b){a.units=b}),a.rename=function(){var b,c="Name:",d=function(a){return a.name===b};do{if(b=prompt(c),!b||b===a.container.name)return;b=b.replace("/","-"),c='Error: "'+b+'" already exists. Name:'}while(a.parent.children.some(d));a.container.name=b},a.prompt=function(b){c.openModal(b+"-"+a.container.$$hashKey)},a.cancel=function(b){a[b]={},c.closeModal(b+"-"+a.container.$$hashKey)},a.newAttribute={},a.showAttribute=function(b){return!(a.container.attributes&&a.container.attributes[b])},a.addAttribute=function(){a.container.attributes=a.container.attributes||{},a.container.attributes[a.newAttribute.name]=a.newAttribute.value,a.cancel("newAttribute")},a.deleteAttribute=function(b){delete a.container.attributes[b],Object.keys(a.container.attributes).length||delete a.container.attributes},a.newSensor={},a.$watchCollection("newSensor",function(){a.newSensor.file&&a.newSensor.file.columns[a.newSensor.column]||(a.newSensor.column=""),a.newSensor.name&&a.units[a.definition.sensors[a.newSensor.name].unit_type]&&a.units[a.definition.sensors[a.newSensor.name].unit_type][a.newSensor.unit]||delete a.newSensor.unit}),a.showSensor=function(b){var c=!1;return angular.forEach(a.container.sensors,function(a){c||a.type!==b||(c=!0)}),!c},a.addSensor=function(){a.newSensor.type=a.newSensor.name,a.container.sensors=a.container.sensors||[],a.container.sensors.unshift(angular.copy(a.newSensor)),a.cancel("newSensor")},a.deleteSensor=function(b){a.container.sensors.splice(b,1)},a.addChild=function(b){var c,d="Name:",e=function(a){return a.name===c};a.container.children=a.container.children||[];do{if(c=prompt(d),!c)return;c=c.replace("/","-"),d="Error: "+a.container.name+'already has child "'+c+'". Name:'}while(a.container.children.some(e));a.container.children.unshift({level:b,name:c})}}],compile:function(b){return a.compile(b)}}}]),angular.module("openeis-ui.filters",[]).filter("bytes",function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"--";"undefined"==typeof b&&(b=0);var c=["B","KB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}).filter("capitalize",function(){return function(a,b){return a?a.substring(0,1).toUpperCase()+a.substring(1):""}}).filter("hasSignature",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){angular.equals(b,a.signature)&&c.push(a)}),c}}).filter("hasTimestamp",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.timestamp&&b.push(a)}),b}}).filter("nl2br",function(){return function(a){return angular.isString(a)?a.replace(/\n/g,"<br>"):a}}),angular.module("openeis-ui.services.analyses",["ngResource"]).service("Analyses",["$resource","$q",function(a,b){var c=this,d=a(settings.API_URL+"analyses/:analysisId",{analysisId:"@id"},{create:{method:"POST"},save:{method:"PUT"}}),e=a(settings.API_URL+"analyses/:analysisId/data");c.get=function(a){return d.get({analysisId:a})},c.query=function(a){return d.query({project:a})},c.create=function(a){return d.create(a)},c.getData=function(a){return e.get({analysisId:a}).$promise.then(function(c){return outputData={},dataPromises=[],angular.forEach(c,function(b,c){"$promise"!==c&&"$resolved"!==c&&dataPromises.push(e.query({analysisId:a,output:c}).$promise.then(function(a){outputData[c]=a}))}),b.all(dataPromises).then(function(){return outputData})})}}]),angular.module("openeis-ui.services.applications",["ngResource"]).service("Applications",["$resource",function(a){var b=this,c=a(settings.API_URL+"applications");b.query=function(){return c.query()}}]),angular.module("openeis-ui.services.auth",["ngResource","ngRoute"]).provider("authRoute",["$routeProvider",function(a){this.whenAnon=function(b,c){return c.resolve=c.resolve||{},angular.extend(c.resolve,{anon:["authRoute",function(a){return a.requireAnon()}]}),a.when(b,c),this},this.whenAuth=function(b,c){return c.resolve=c.resolve||{},angular.extend(c.resolve,{auth:["authRoute",function(a){return a.requireAuth()}]}),a.when(b,c),this},this.when=function(b,c){return a.when(b,c),this},this.$get=["Auth","$q","$location",function(a,b,c){return{requireAnon:function(){var d=b.defer();return a.account().then(function(a){a?(c.url(settings.AUTH_HOME),d.reject()):d.resolve()}),d.promise},requireAuth:function(){var d=b.defer();return a.account().then(function(b){b?d.resolve():(a.loginRedirect(c.url()),c.url(settings.LOGIN_PAGE),d.reject())}),d.promise}}}]}]).service("Auth",["$resource","$q","$location","$rootScope",function(a,b,c,d){function e(){var a=b.defer();return h.get().$promise.then(function(a){g=a},function(){g=!1})["finally"](function(){d.$broadcast("accountChange"),a.resolve(g)}),a.promise}var f=this,g=null,h=a(settings.API_URL+"account",null,{create:{method:"POST"},update:{method:"PATCH"}}),i=a(settings.API_URL+"account/login"),j=a(settings.API_URL+"account/change_password"),k=a(settings.API_URL+"account/password_reset",null,{put:{method:"PUT"}}),l=null;f.account=function(){if(null===g)return e();var a=b.defer();return a.resolve(g),a.promise},f.accountCreate=function(a){return h.create(a).$promise},f.accountUpdate=function(a){return h.update(a).$promise},f.accountPassword=function(a){return j.save(a).$promise},f.accountRecover1=function(a){return k.save({username_or_email:a}).$promise},f.accountRecover2=function(a){return k.put(a).$promise},f.logIn=function(a){var d=b.defer();return i.save(a,function(){e().then(function(){null!==l?(c.url(l),l=null):c.url(settings.AUTH_HOME),d.resolve()})},function(a){d.reject(a)}),d.promise},f.loginRedirect=function(a){l=a},f.logOut=function(){var a=b.defer();return i["delete"](function(){g=!1,d.$broadcast("accountChange"),c.url(settings.LOGIN_PAGE),a.resolve()},function(b){a.reject(b)}),a.promise}}]),angular.module("openeis-ui.services.data-files",["ngResource"]).service("DataFiles",["$resource","$http",function(a,b){var c=this,d=a(settings.API_URL+"files/:fileId",{fileId:"@id"},{head:{method:"GET",url:settings.API_URL+"files/:fileId/head"},save:{method:"PUT"},update:{method:"PATCH"}});c.get=function(a){return d.get({fileId:a}).$promise},c.query=function(a){return d.query({project:a}).$promise},c.update=function(a){return d.update(a).$promise},c.head=function(a){return d.head({fileId:a,rows:5}).$promise},c.timestamps=function(a,c,d,e){return b.get(settings.API_URL+"files/"+a+"/timestamps",{transformResponse:angular.fromJson,params:{time_offset:c,time_zone:d,columns:e}}).then(function(a){return a.data})}}]),angular.module("openeis-ui.services.data-maps",["ngResource","openeis-ui.services.data-files"]).service("DataMaps",["$http","$q","$resource","DataFiles",function(a,b,c,d){var e=this,f=c(settings.API_URL+"datamaps/:mapId",{mapId:"@id"},{create:{method:"POST"},save:{method:"PUT"}});e.get=function(a){return f.get({mapId:a})},e.query=function(a){return f.query({project:a})},e.create=function(a){var b=angular.copy(a);return b.map=e.flattenMap(b.map),f.create(b)},e.getDefaultMap=function(a){return{project:a,map:{version:1,children:[{level:"building",name:"New building"}]},valid:!1}},e.getDefinition=function(){return a.get(settings.GENERAL_DEFINITION_URL).then(function(a){return a.data})},e.getUnits=function(){return a.get(settings.UNITS_URL).then(function(a){return a.data})},e.flattenMap=function(a){function b(a,c){var f={};return angular.forEach(a,function(a){if(a.deleted!==!0){delete a.deleted;var g=c+a.name.replace("/","-"),h=a.sensors||{},i=a.children||{};delete a.name,delete a.sensors,delete a.children,a.file&&(a.file.hasHeader?a.column=a.file.columns[parseInt(a.column)]:a.column=parseInt(a.column),d[a.file.name]||(d[a.file.name]={key:e++ +"",signature:a.file.signature,timestamp:a.file.timestamp}),a.file=d[a.file.name].key),f[g]=a,angular.extend(f,b(h,g+settings.DATAMAP_TOPIC_SEPARATOR)),angular.extend(f,b(i,g+settings.DATAMAP_TOPIC_SEPARATOR))}}),f}var c=angular.copy(a),d={},e=0;return c.sensors=b(c.children,""),delete c.children,c.files=c.files||{},angular.forEach(d,function(a,b){c.files[a.key]=a,delete c.files[a.key].key}),c},e.unFlattenMap=function(a,b){var c=Object.getOwnPropertyNames(a.map.sensors).sort();return angular.forEach(a.map.files,function(c,d){angular.forEach(b,function(b){angular.equals(c.signature,b.signature)&&angular.equals(c.timestamp,b.timestamp)&&(a.map.files[d]=b)})}),a.map.children=[],angular.forEach(c,function(b){function c(a){a.name===g&&(f=a)}for(var d=a.map.sensors[b],e=b.split("/"),f=a.map;e.length>1;){var g=e.shift();angular.forEach(f.children,c)}d.name=e[0],d.level?(d.children=[],d.sensors=[],f.children.push(d)):d.type&&(a.map.files[d.file].name?(d.file=a.map.files[d.file],d.file.hasHeader&&(d.column=d.file.columns.indexOf(d.column))):(d.file={name:"MISSING FILE",columns:{}},d.file.columns[d.column]="MISSING COLUMN"),f.sensors.push(d))}),delete a.id,delete a.map.files,delete a.map.sensors,a.name+=" copy",a},e.validateMap=function(b){return a.get(settings.DATAMAP_SCHEMA_URL).then(function(a){return tv4.validateMultiple(e.flattenMap(b),a.data)})},e.ensureFileMetaData=function(a){var c=[];return angular.forEach(a,function(a){a.hasOwnProperty("signature")&&a.hasOwnProperty("columns")&&a.hasOwnProperty("hasHeader")||c.push(d.head(a.id).then(function(b){a.signature={headers:[]},a.columns=[],a.hasHeader=b.has_header,angular.forEach(b.rows[0],function(b,c){a.hasHeader?(a.signature.headers.push(b),a.columns.push(b)):(a.signature.headers.push(null),a.columns.push("Column "+(c+1)))})}))}),b.all(c)}}]),angular.module("openeis-ui.services.data-set-filters",["ngResource"]).service("DataSetFilters",["$resource",function(a){var b=this,c=a(settings.API_URL+"filters");b.query=function(){return c.query()}}]),angular.module("openeis-ui.services.data-sets",["ngResource"]).service("DataSets",["$resource","$http",function(a,b){var c=this,d=a(settings.API_URL+"datasets/:dataSetId",{dataSetId:"@id"},{create:{method:"POST"},save:{method:"PUT"},preview:{method:"POST",url:settings.API_URL+"datasets/preview"},head:{url:settings.API_URL+"datasets/:dataSetId/head"}});c.create=function(a){return d.create(a)},c.get=function(a){return d.get({dataSetId:a})},c.query=function(a){return d.query({project:a})},c.manipulate=function(a,c){return b({method:"POST",url:settings.API_URL+"datasets/"+a.id+"/manipulate",data:{config:c},transformResponse:angular.fromJson})},c.preview=function(a,b){return d.preview({map:a,files:b,rows:10})},c.head=function(a){return d.head({dataSetId:a,rows:10})},c.getStatus=function(a){return b({method:"GET",url:settings.API_URL+"datasets/"+a.id+"/status",transformResponse:angular.fromJson})},c.getErrors=function(a){return b({method:"GET",url:settings.API_URL+"datasets/"+a.id+"/errors",transformResponse:angular.fromJson})}}]),angular.module("openeis-ui.services.projects",["ngResource"]).service("Projects",["$resource",function(a){var b=this,c=a(settings.API_URL+"projects/:projectId",{projectId:"@id"},{create:{method:"POST"},save:{method:"PUT"},clone:{method:"POST",url:settings.API_URL+"projects/:projectId/clone"}});b.get=function(a){return c.get({projectId:a}).$promise},b.query=function(){return c.query().$promise},b.create=function(a){return c.create(a).$promise},b.clone=function(a,b){return c.clone({projectId:a},{name:b}).$promise}}]),angular.module("openeis-ui.services.shared-analyses",["ngResource"]).service("SharedAnalyses",["$resource","$q",function(a,b){var c=this,d=a(settings.API_URL+"shared-analyses/:analysisId",{analysisId:"@analysis"}),e=a(settings.API_URL+"shared-analyses/:analysisId/data");c.get=function(a,b){return d.get({analysisId:a,key:b})},c.query=function(a){return d.query({project:a})},c.create=function(a){return d.save({analysisId:null},{analysis:a})},c.getData=function(a,c){return e.get({analysisId:a,key:c}).$promise.then(function(d){return outputData={},dataPromises=[],angular.forEach(d,function(b,d){"$promise"!==d&&"$resolved"!==d&&dataPromises.push(e.query({analysisId:a,key:c,output:d}).$promise.then(function(a){outputData[d]=a}))}),b.all(dataPromises).then(function(){return outputData})})}}]);var settings={BASE_HREF:"/",API_URL:"/api/",LOGIN_PAGE:"/",AUTH_HOME:"/projects",GENERAL_DEFINITION_URL:"/static/projects/json/general_definition.json",DATAMAP_SCHEMA_URL:"/static/projects/json/sensormap-schema.json",UNITS_URL:"/static/projects/json/units.json",TIMEZONES_URL:"/static/projects/json/time_zones.json",DATAMAP_TOPIC_SEPARATOR:"/"};angular.module("openeis-ui").run(["$templateCache",function(a){"use strict";a.put("404.tpl.html","<h2>404 Page not found</h2>"),a.put("account.tpl.html",'<div class=container><ul class=breadcrumbs><li>Account</li></ul><div class="view view--account"><h2>Account</h2><h3>Profile</h3><form ng-submit=profile.update()><div class=form__group><label>Username</label><input ng-model=account.username disabled></div><div class=form__group><label for=name>Name</label><input id=name type=text ng-model=account.first_name></div><div class=form__group><label for=email>Email address</label><input id=email type=email ng-change="profile.error.data.email = false" ng-model=account.email> <small class="help help--error" ng-if=profile.error.data.email>{{profile.error.data.email}}</small></div><div class=form__group><button ng-disabled=!profile.changed>Update profile</button></div><div class="alert alert--success animated--slow-out" ng-if=profile.success>Profile updated.</div><div class="alert alert--error" ng-if="profile.error.status && profile.error.status !== 400">Unknown error occurred. ({{profile.error.status}})</div></form><h3>Password</h3><form ng-submit=password.update()><div class=form__group><label for=current-password>Current password</label><input id=current-password type=password autocomplete=off ng-trim=false ng-change="password.error.data.old_password = false" required ng-model=password.current> <small class="help help--error" ng-if=password.error.data.old_password>{{password.error.data.old_password}}</small><br><label for=new-password>New password</label><input id=new-password type=password autocomplete=off required ng-trim=false ng-change="password.mismatch = false; password.error.data.new_password = false" ng-model=password.new> <small class="help help--error" ng-if=password.error.data.new_password>{{password.error.data.new_password}}</small><br><label for=confirm-new-password>Confirm new password</label><input id=confirm-new-password type=password autocomplete=off required ng-trim=false ng-change="password.mismatch = false" ng-model=password.newConfirm> <small class="help help--error" ng-if=password.mismatch>New passwords do not match.</small><br></div><div class=form__group><button ng-disabled="!(password.current && password.new && password.newConfirm)" ng-click=updatePassword()>Update password</button></div><div class="alert alert--success animated--slow-out" ng-if=password.success>Password updated.</div></form></div></div>'),a.put("configure-timestamp.tpl.html",'<h4>Configure timestamp: {{timestampFile.name}}</h4><form ng-if=!modal.confirm ng-submit=preview()><table class=table--file-preview><thead><tr><th colspan={{timestampFile.cols.length}}>Select columns that comprise timestamp:</th></tr><tr><th ng-repeat="col in timestampFile.cols"><input type=checkbox ng-model=modal.columns[$index]></th></tr><tr ng-if=timestampFile.head.header.length><th ng-repeat="header in timestampFile.head.header"><label for={{$index}}>{{header}}</label></th></tr></thead><tbody><tr ng-repeat="row in timestampFile.head.rows"><td ng-repeat="col in row track by $index">{{col}}</td></tr></tbody></table><div class=form__group><label class=label--inline>Apply offset to timestamps</label>&nbsp; <input type=number step=0.000001 required ng-model=modal.timeOffset>&nbsp;seconds</div><div class=form__group><label class=label--inline>If unable to determine time zone, use</label>&nbsp;<select class=select--inline required ng-options="timeZone for timeZone in timeZones" ng-model=modal.timeZone></select></div><button>Continue</button> <button type=button ng-click="Modals.closeModal(\'configureTimestamp\')">Cancel</button></form><div ng-if=modal.confirm><table><thead><tr><th>Raw</th><th>Parsed</th></tr></thead><tbody><tr ng-repeat="row in modal.timestamps | limitTo:5"><td>{{row[0]}}</td><td>{{row[1]}}</td></tr></tbody></table><p>Are the parsed timestamps correct?</p><button ng-click=save()>Yes, save configuration</button> <button ng-click="modal.confirm = false">No, re-select columns</button> <button ng-click="Modals.closeModal(\'configureTimestamp\')">Cancel</button></div>'),a.put("data-map.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li><a href=projects/{{project.id}}>{{project.name}}</a></li><li>Data map: {{dataMap.name}}</li></ul><div class="view view--data-map"><h2>Data map: {{dataMap.name}}</h2><pre>{{dataMap.map | json}}</pre><a class=button href=projects/{{project.id}}>Back</a></div></div>'),a.put("data-set-manipulate.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li><a href=projects/{{project.id}}>{{project.name}}</a></li><li>Manipulate data set: {{dataSet.name}}</li></ul><form class="view view--data-set-manipulate" ng-submit=apply()><h2>Manipulate data set: {{dataSet.name}}</h2><div ng-show=!applying><div><h3>Normalization settings</h3><div class=form__group><label>Perform</label>&nbsp; <input type=checkbox id=perform-fill ng-model=globalSettings.performFill>&nbsp;<label for=fill>Fill</label>&nbsp; <input type=checkbox id=perform-aggregation ng-model=globalSettings.performAggregation>&nbsp;<label for=perform-aggregation>Aggregation</label></div><div class=form__group><label>Fill/aggregation time period</label>&nbsp; <input type=number step=1 min=1 required ng-model=globalSettings.periodSeconds> second<span ng-if="globalSettings.periodSeconds > 1">s</span></div><div class=form__group ng-if=globalSettings.performFill><label>On fill</label>&nbsp; <input type=checkbox id=drop-values ng-model=globalSettings.dropExtra>&nbsp;<label for=drop-values>Drop values that do not line up exactly with specified period</label></div><div class=form__group ng-if=globalSettings.performAggregation><label>On aggregation</label>&nbsp; <input type=radio id=round-time ng-model=globalSettings.roundTime ng-value=true>&nbsp;<label for=round-time>Round time to nearest period</label>&nbsp; <input type=radio id=truncate-time ng-model=globalSettings.roundTime ng-value=false>&nbsp;<label for=truncate-time>Truncate time to period</label></div></div><h3>Sensors</h3><div class=topic ng-repeat="(topic, sensor) in dataSet.datamap.sensors" ng-if=sensor.type ng-init="initTopicFilters(topic, sensor)"><h4>{{topic}}</h4><div class=layout><div class=layout__item><fieldset><legend>Normalization filters</legend><div class=form__group ng-if=globalSettings.performFill><label>Fill</label>&nbsp;<select ng-options="filter.id as filter.name for filter in availableFilters | filter:{type: \'fill\'} | orderBy:\'name\'" ng-model=topicFilters[topic].fill><option value="">None</option></select></div><div class=form__group ng-if=globalSettings.performAggregation><label>Aggregation</label>&nbsp;<select required ng-options="filter.id as filter.name for filter in availableFilters | filter:{type: \'aggregation\'} | orderBy:\'name\'" ng-model=topicFilters[topic].aggregation><option value="">-- Choose filter --</option></select></div></fieldset></div><div class=layout__item><fieldset><legend>Other filters</legend><ol><li ng-repeat="filter in topicFilters[topic].other">{{filter | json}} &mdash; <a ng-click=deleteFilter(filter)>Delete</a> <span ng-if=!$first>&mdash; <a ng-click=raiseFilter(filter)>Up</a></span> <span ng-if=!$last>&mdash; <a ng-click=lowerFilter(filter)>Down</a></span></li></ol><p><a ng-click=addFilterTo(topic)>Add filter to {{topic}}&hellip;</a></p></fieldset></div></div></div><button>Apply</button> <a class=button href=projects/{{project.id}}>Cancel</a></div><div ng-show=applying><span class="spinner fa fa-circle-o-notch"></span> Applying filters&hellip;</div></form></div><modal modal-id=newFilter><h3>Add filter</h3><form class=form--stacked ng-submit=saveNewFilter()><div class=form__group><label>Sensor</label><div>{{newFilter.topic}}</div></div><div class=form__group><label>Filter</label><select required ng-options="filter as filter.name for filter in availableFilters | filter:{type: \'other\'} | orderBy:\'name\'" ng-model=newFilter.filter><option value="">-- Choose filter --</option><select></select></select></div><div class=form__group ng-if=newFilter.filter ng-init="newFilter.parameters[paramName] = param.value_default" ng-repeat="(paramName, param) in newFilter.filter.parameters"><label>{{param.display_name}}</label><input type=checkbox ng-if="param.config_type === \'bool\'" ng-model=newFilter.parameters[paramName]> <input value={{param.value_default}} type=number step=1 ng-if="param.config_type === \'int\' && !param.value_list" min={{param.value_min}} max={{param.value_max}} ng-required=!param.optional ng-model=newFilter.parameters[paramName]> <small class=help ng-if=param.description ng-bind-html="param.description | nl2br"></small></div><button>Add</button> <button type=button ng-click="Modals.closeModal(\'newFilter\')">Cancel</button></form></modal>'),a.put("data-set.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li><a href=projects/{{project.id}}>{{project.name}}</a></li><li>Data set: {{dataSet.name}}</li></ul><div class="view view--data-set"><h2>Data set: {{dataSet.name}}</h2><table><thead><tr><th ng-repeat="column in data.cols">{{column}}</th></tr></thead><tbody><tr ng-repeat="row in data.rows"><td ng-repeat="value in row track by $index">{{value}}</td></tr><tr ng-repeat-start="row in data.extra_rows"><td class=table-gap colspan={{data.cols.length}}>&hellip;</td></tr><tr ng-repeat-end><td ng-repeat="value in row track by $index">{{value}}</td></tr></tbody></table><a class=button href=projects/{{project.id}}>Back</a></div></div>'),a.put("login.tpl.html",'<div class=container><div class="view view--login"><h1>OpenEIS</h1><form ng-submit=logIn()><div class=form__group><input type=text placeholder=Username required ng-model=form.username ng-change=clearError()></div><div class=form__group><input type=password placeholder=Password required ng-model=form.password ng-trim=false ng-change=clearError()></div><div class=form__group><button type=submit>Log in</button><div class=links><a href=sign-up>Need an account?</a><br><a href=recovery>Can\'t log in?</a></div></div><div class="alert alert--error" ng-if=form.error ng-switch=form.error><span ng-switch-when=403>Authentication failed.</span> <span ng-switch-default>Unknown error occurred. ({{form.error}})</span></div></form></div></div>'),a.put("new-analysis.tpl.html",'<h4>New analysis</h4><div ng-if=!newAnalysis.application><div class=form__group><label class=label--inline>Run analysis on</label>&nbsp;<select ng-options="dataSet as dataSet.name for dataSet in dataSets" ng-model=newAnalysis.dataSet><option value="">-- Choose data set --</option></select></div><table class=table--app-list ng-if=newAnalysis.dataSet><thead><tr><th>Application</th><th>Configure</th><th>Missing inputs</th></tr></thead><tbody><tr ng-repeat="app in availableApps | orderBy:\'name\'"><td>{{app.name}}</td><td><button ng-disabled=app.missingInputs ng-click="newAnalysis.application = app">Configure</button></td><td><p ng-if=app.description>{{app.description}}</p><ul class=missing-inputs ng-if=app.missingInputs><li ng-repeat="missingInput in app.missingInputs">{{missingInput}}</li></ul></td></tr></tbody></table><button ng-click="Modals.closeModal(\'newAnalysis\')">Cancel</button></div><form class=form--stacked ng-if=newAnalysis.application ng-submit=run()><h5>Configure run of <em>{{newAnalysis.application.name}}</em> on data set <em>{{newAnalysis.dataSet.name}}</em></h5><div class=form__group><input type=checkbox id=debug ng-model=newAnalysis.debug>&nbsp;<label for=debug>Generate debug output</label></div><div class=layout><div class=layout__item style="width: 50%"><fieldset><legend>Parameters</legend><div class=form__group ng-repeat="(paramName, param) in newAnalysis.application.parameters" ng-init=setParamDefault(paramName)><label>{{param.display_name}}<span ng-if=param.optional>&nbsp;(optional)</span></label><select ng-if=param.value_list ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName] ng-options="value for value in param.value_list"><option value="">-- Choose value --</option></select><input type=text ng-if="param.config_type === \'str\' && !param.value_list" ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName]> <input type=number step=1 ng-if="param.config_type === \'int\' && !param.value_list" min={{param.value_min}} max={{param.value_max}} ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName]> <input type=number step=0.01 ng-if="param.config_type === \'float\' && !param.value_list" min={{param.value_min}} max={{param.value_max}} ng-required=!param.optional ng-model=newAnalysis.configuration.parameters[paramName]></div></fieldset></div><div class=layout__item style="width: 50%"><fieldset><legend>Inputs</legend><div class=form__group ng-repeat="(inputName, input) in newAnalysis.application.inputs"><label>{{input.display_name}} ({{input.sensor_type}})</label><div ng-repeat="multiInput in newAnalysis.configuration.inputs[inputName]" style="position: relative"><select required ng-options="topic.value as topic.display for topic in availableSensors[input.sensor_type]" ng-model=newAnalysis.configuration.inputs[inputName][$index]><option value="">-- Choose sensor --</option></select><div class=app-input-delete ng-if="newAnalysis.configuration.inputs[inputName].length > input.count_min" ng-click="deleteInputSensor(inputName, $index)">&times;</div></div><a ng-if="canAddSensor(inputName, input.sensor_type)" ng-click=addInputSensor(inputName)>+ Add sensor</a></div></fieldset></div></div><button type=button ng-click="newAnalysis.application = null">Back</button> <button>Run</button> <button type=button ng-click="Modals.closeModal(\'newAnalysis\')">Cancel</button></form>'),a.put("new-data-map.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li><a href=projects/{{project.id}}>{{project.name}}</a></li><li>New data map</li></ul><div class="view view--new-data-map"><h2>New data map</h2><div class=form__group>Add to data map:<span ng-repeat="child in [\'site\', \'building\', \'other\']">&nbsp;<button ng-click=addChild(child)>{{child}}</button></span></div><sensor-container ng-repeat="child in newDataMap.map.children" container=child parent=newDataMap.map files=dataFiles></sensor-container><form ng-submit=save()><label class=label--inline>Data map name</label>&nbsp; <input class=input--inline required ng-model=newDataMap.name> &nbsp;<button type=button ng-click=preview() ng-disabled=!newDataMap.valid>Preview</button> &nbsp;<button ng-disabled=!newDataMap.valid>Save</button> &nbsp;<a class=button href=projects/{{project.id}}>Cancel</a> <small class="help help--error" ng-if=!newDataMap.valid>Add at least one object and sensor to save</small></form></div><modal modal-id=dataMapPreview><table><thead><tr><th ng-repeat="column in dataMapPreview.cols">{{column}}</th></tr></thead><tbody><tr ng-repeat="row in dataMapPreview.rows"><td ng-repeat="value in row track by $index"><span ng-if=!isObject(value)>{{value}}</span> <span class=invalid-value ng-if=isObject(value) ng-click=showError(value)>Invalid</span></td></tr><tr ng-repeat-start="row in dataMapPreview.extra_rows"><td class=table-gap colspan={{dataMapPreview.cols.length}}>&hellip;</td></tr><tr ng-repeat-end><td ng-repeat="value in row track by $index"><span ng-if=!isObject(value)>{{value}}</span> <span class=invalid-value ng-if=isObject(value) ng-click=showError(value)>Invalid</span></td></tr></tbody></table><button ng-click="Modals.closeModal(\'dataMapPreview\')">Close</button></modal></div>'),
a.put("new-data-set.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li><a href=projects/{{project.id}}>{{project.name}}</a></li><li>New data set</li></ul><div class="view view--new-data-set"><h2>New data set</h2><form ng-submit=submit()><div class=form__group><h5>Select data map to use</h5><select required ng-options="dataMap as dataMap.name for dataMap in dataMaps" ng-model=newDataSet.map><option value="">-- Choose data map --</option></select></div><div class=form__group ng-if=newDataSet.map><h5>Select files to use</h5><dl><dt ng-repeat-start="(key, file) in newDataSet.map.map.files">File "{{key}}":</dt><dt><dd ng-repeat-end>Signature:<pre>{{file.signature.headers}}</pre><select required ng-options="file as file.name for file in dataFiles | hasSignature:file.signature" ng-model=newDataSet.files[key]><option value="">-- Choose file --</option></select></dd></dt></dl></div><button ng-click="newDataSet.action = \'preview\'">Preview</button> <button ng-click="newDataSet.action = \'save\'">Create</button> <a class=button href=projects/{{project.id}}>Cancel</a></form><modal modal-id=dataSetPreview><table><thead><tr><th ng-repeat="column in dataSetPreview.cols">{{column}}</th></tr></thead><tbody><tr ng-repeat="row in dataSetPreview.rows"><td ng-repeat="value in row track by $index"><span ng-if=!isObject(value)>{{value}}</span> <span class=invalid-value ng-if=isObject(value) ng-click=showError(value)>Invalid</span></td></tr><tr ng-repeat-start="row in dataSetPreview.extra_rows"><td class=table-gap colspan={{dataSetPreview.cols.length}}>&hellip;</td></tr><tr ng-repeat-end><td ng-repeat="value in row track by $index"><span ng-if=!isObject(value)>{{value}}</span> <span class=invalid-value ng-if=isObject(value) ng-click=showError(value)>Invalid</span></td></tr></tbody></table><button ng-click="Modals.closeModal(\'dataSetPreview\')">Close</button></modal></div></div>'),a.put("project.tpl.html",'<div class=container><ul class=breadcrumbs><li><a href=projects>Projects</a></li><li>{{project.name}}</li></ul><div class="view view--project"><h2>{{project.name}}</h2><div class=data-files><h3>Data files</h3><p><button ng-click="Modals.openModal(\'uploadFile\')">Upload file&hellip;</button></p><table ng-if=dataFiles.length><thead><tr><th>Name</th><th>Size</th></tr></thead><tbody><tr ng-repeat="file in dataFiles"><td>{{file.name}}<div class="edit-menu drop-down"><a class=drop-down__toggle><span class="fa fa-caret-right"></span></a><div class=drop-down__container><a class=drop-down__item ng-click=configureTimestamp($index)>Configure timestamp</a> <a class=drop-down__item href={{file.download_url}} target=_self>Download</a> <a class=drop-down__item ng-click="rename(\'dataFiles\', $index)">Rename</a> <a class=drop-down__item ng-click="delete(\'dataFiles\', $index)">Delete</a></div></div><span class=meta-tag ng-if=file.format>{{file.format | uppercase}}</span> <a class="meta-tag meta-tag--error" ng-if=!file.timestamp ng-click=configureTimestamp($index)>Needs timestamp configuration</a></td><td>{{file.size | bytes}}</td></tr></tbody></table></div><modal class=modal--upload-file modal-id=uploadFile><div class=form__group ng-if=!uploading><label class=label--inline>Upload file</label>&nbsp;<file-upload file-upload-click="upload(files, onUpload)"></file-upload>&nbsp;<button ng-click="Modals.closeModal(\'uploadFile\')">Cancel</button></div><div class=form__group ng-if=uploading><span class="spinner fa fa-circle-o-notch"></span> Uploading file&hellip;</div></modal><modal class=modal--file-timestamp modal-id=configureTimestamp><ng-include src="\'configure-timestamp.tpl.html\'" ng-controller=ConfigureTimestampCtrl></ng-include></modal><div class=layout><div class=data-maps><h3>Data maps</h3><p><form action="{{\'projects/\' + project.id + \'/new-data-map\'}}"><button ng-disabled="!(dataFiles | hasTimestamp).length">Create new data map&hellip;</button></form></p><p class="help help--error" ng-if="!(dataFiles | hasTimestamp).length">Data file with timestamp configuration required.</p><table ng-if=dataMaps.length><thead><tr><th>Name</th></tr></thead><tbody><tr ng-repeat="dataMap in dataMaps"><td>{{dataMap.name}}<div class="edit-menu drop-down"><a class=drop-down__toggle><span class="fa fa-caret-right"></span></a><div class=drop-down__container><a class=drop-down__item href=projects/{{project.id}}/datamaps/{{dataMap.id}}>View</a> <a class=drop-down__item href=projects/{{project.id}}/datamaps/{{dataMap.id}}/clone-and-edit>Edit copy</a> <a class=drop-down__item ng-click="rename(\'dataMaps\', $index)">Rename</a> <a class=drop-down__item ng-click="delete(\'dataMaps\', $index)">Delete</a></div></div></td></tr></tbody></table></div><div class=data-sets><h3>Data sets</h3><p><form action="{{\'projects/\' + project.id + \'/new-data-set\'}}"><button ng-disabled=!dataMaps.length>Create new data set&hellip;</button></form></p><p class="help help--error" ng-if=!dataMaps.length>Data map required.</p><table ng-if=dataSets.length><thead><tr><th>Name</th><th>Status</th><th>Errors</th></tr></thead><tbody><tr ng-repeat="dataSet in dataSets"><td><span ng-if="dataSet.status.status !== \'complete\'">{{dataSet.name}}</span> <a href=projects/{{project.id}}/datasets/{{dataSet.id}} ng-if="dataSet.status.status === \'complete\'">{{dataSet.name}}</a><div class="edit-menu drop-down"><a class=drop-down__toggle><span class="fa fa-caret-right"></span></a><div class=drop-down__container><a class=drop-down__item href=projects/{{project.id}}/datasets/{{dataSet.id}} ng-if="dataSet.status.status === \'complete\'">View</a> <a class=drop-down__item href=projects/{{project.id}}/datasets/{{dataSet.id}}/manipulate ng-if="dataSet.status.status === \'complete\'">Manipulate</a> <a class=drop-down__item href="{{dataSet.download_url}}?format=csv" target=_self>Download</a> <a class=drop-down__item ng-click="rename(\'dataSets\', $index)">Rename</a> <a class=drop-down__item ng-click="delete(\'dataSets\', $index)">Delete</a></div></div></td><td>{{dataSet.status.status || \'Checking&hellip;\' | capitalize}}</td><td ng-if=!dataSet.errors.length>None</td><td ng-if=dataSet.errors.length><a ng-click=showErrors(dataSet)><ng-pluralize count=dataSet.errors.length when="{\'one\': \'1 error\', \'other\': \'{} errors\'}"></ng-pluralize></a></td></tr></tbody></table></div><modal class=modal--data-set-errors modal-id=dataSetErrors><h4>Errors</h4><table><thead><tr><th>Message</th><th>Location</th></tr></thead><tbody><tr ng-repeat="error in errorsModal.errors"><td>{{error.message}}</td><td>{{errorsModal.files[error.file]}}: row {{error.row}}, column {{error.column}}</td></tr></tbody></table><button ng-click="Modals.closeModal(\'dataSetErrors\')">Close</button></modal><modal class=modal--new-data-set modal-id=newDataSet><ng-include src="\'new-data-set.tpl.html\'" ng-controller=NewDataSetCtrl></ng-include></modal></div><div class=analyses><h3>Analyses</h3><p><button ng-click="Modals.openModal(\'newAnalysis\')">Run analysis&hellip;</button></p><table ng-if=analyses.length><thead><tr><th>Name</th><th>Status</th><th>Added</th><th>Report</th></tr></thead><tbody><tr ng-repeat="analysis in analyses"><td><span ng-if="analysis.status.slice(-8) !== \'complete\'">{{analysis.name}}</span> <a ng-if="analysis.status.slice(-8) === \'complete\'" ng-click=viewAnalysis(analysis)>{{analysis.name}}</a><div class="edit-menu drop-down"><a class=drop-down__toggle><span class="fa fa-caret-right"></span></a><div class=drop-down__container><a class=drop-down__item ng-if="analysis.status.slice(-8) === \'complete\'" ng-click=viewAnalysis(analysis)>View</a> <a class=drop-down__item ng-if="analysis.status.slice(-8) === \'complete\'" href={{getAnalysisOutputUrl(analysis.id)}} target=_self>Download output</a> <a class=drop-down__item ng-if="analysis.status.slice(-8) === \'complete\' && !(sharedAnalyses | filter:{analysis:analysis.id}).length" ng-click=shareAnalysis(analysis)>Share</a> <a class=drop-down__item ng-if="(sharedAnalyses | filter:{analysis:analysis.id}).length" ng-click=revokeLink(analysis.id)>Revoke sharing</a> <a class=drop-down__item ng-click="rename(\'analyses\', $index)">Rename</a> <a class=drop-down__item ng-if="analysis.status.slice(-8) === \'complete\'" ng-click="delete(\'analyses\', $index)">Delete</a></div></div></td><td>{{analysis.status | capitalize}}</td><td>{{analysis.added | date:\'medium\'}}</td><td><a ng-if="analysis.status.slice(-8) === \'complete\' && !(sharedAnalyses | filter:{analysis:analysis.id}).length" ng-click=shareAnalysis(analysis)>Share</a> <span ng-if="(sharedAnalyses | filter:{analysis:analysis.id}).length"><a ng-click=viewLink(analysis.id)>Shared</a> (<a ng-click=revokeLink(analysis.id)>revoke</a>)</span></td></tr></tbody></table></div><modal class=modal--new-analysis modal-id=newAnalysis><ng-include src="\'new-analysis.tpl.html\'" ng-controller=NewAnalysisCtrl></ng-include></modal><modal class=modal--analysis modal-id=viewAnalysis><h4>{{viewingAnalysis.name}}</h4><div class=form__group ng-if=!viewingAnalysisData><span class="spinner fa fa-circle-o-notch"></span> Loading analysis&hellip;</div><analysis-report ng-repeat="report in viewingAnalysis.reports" ng-if=viewingAnalysisData ar-report=report ar-data=viewingAnalysisData></analysis-report><button ng-click="Modals.closeModal(\'viewAnalysis\')">Close</button></modal><modal class=modal--view-link modal-id=viewLink><p><a href={{viewingLink.url}} target=_self>{{viewingLink.url}}</a></p><button ng-click=revokeLink(viewingLink.sharedAnalysis.analysis)>Revoke</button> <button ng-click="Modals.closeModal(\'viewLink\')">Close</button></modal></div></div>'),a.put("projects.tpl.html",'<div class=container><ul class=breadcrumbs><li>Projects</li></ul><div class="view view--projects"><h2>Projects</h2><ul ng-if=projects.length><li ng-repeat="project in projects"><a ng-href=projects/{{project.id}}>{{project.name}}</a> &mdash; <a ng-click=renameProject($index)>Rename</a> &mdash; <a ng-click=deleteProject($index)>Delete</a> &mdash; <a ng-click=cloneProject($index)>Clone</a></li></ul><form ng-submit=newProject.create()><label class=label--inline>Create new project</label>&nbsp; <input class=input--inline type=text placeholder=Name ng-model=newProject.name required> &nbsp;<button type=submit>Create</button></form></div></div>'),a.put("recovery.tpl.html",'<div class=container><div class="view view--recovery"><h1><a href="/">OpenEIS</a></h1><form class=panel ng-submit=submit()><h2>Recover account</h2><div class=form__group ng-if="form.stage === 1"><label for=recoveryId>Username or email address</label><input id=recoveryId type=text required ng-change=clearError() ng-trim=false ng-model=recovery.id></div><div class=form__group ng-if="form.stage === 2"><label>Username</label><input type=text disabled ng-model=recovery.username></div><div class=form__group ng-if="form.stage === 2"><label for=password>New password</label><input id=password type=password required ng-trim=false ng-model=recovery.password><br><label for=password>Confirm new password</label><input type=password required ng-trim=false ng-model=recovery.passwordConfirm></div><div class=form__group ng-if=form.stage><button type=submit>Submit</button></div><div class="alert alert--success" ng-if=form.success>{{form.success}}</div><div class="alert alert--error" ng-if=form.error ng-switch=form.error.status><span ng-switch-when=400>{{form.error.data}}</span> <span ng-switch-when=404>{{form.error.data}}</span> <span ng-switch-default>Unknown error occurred. ({{form.error}})</span></div></form></div></div>'),a.put("sensor-container-directive.tpl.html",'<div ng-if=container.deleted><strong>{{container.level | capitalize}}: {{container.name}}</strong> deleted. (<a ng-click="container.deleted = false">undo</a>)</div><div ng-if=!container.deleted><h1>{{container.level | capitalize}}: {{container.name}} <button ng-click=rename()>Rename</button> <button ng-click="container.deleted = true">Delete</button></h1><div class=layout><div class=layout__item style=width:50% ng-if="(objectDefinition.attribute_list | filter:showAttribute).length || container.attributes"><fieldset><legend>Attributes</legend><modal modal-id=newAttribute-{{container.$$hashKey}} ng-if="(objectDefinition.attribute_list | filter:showAttribute).length"><form class=form--stacked ng-submit=addAttribute()><div class=form__group><label>New attribute</label><select required ng-options="attribute for attribute in objectDefinition.attribute_list | filter:showAttribute" ng-model=newAttribute.name><option value="">-- Choose attribute --</option></select></div><div class=form__group ng-if="newAttribute.name && definition.attributes[newAttribute.name].data_type === \'enum\'"><select required ng-options="value for value in definition.attributes[newAttribute.name].data_values" ng-model=newAttribute.value><option value="">--- Choose value---</option></select></div><div class=form__group ng-if="newAttribute.name && !definition.attributes[newAttribute.name].data_type" ng-init="newAttribute.value = {}"><label ng-repeat-start="(name, property) in definition.attributes[newAttribute.name]">{{name}}</label><input ng-model=newAttribute.value[name]><br ng-repeat-end></div><button>Add</button> <button type=button ng-click="cancel(\'newAttribute\')">Cancel</button></form></modal><dl ng-if=container.attributes><dt ng-repeat-start="(attribute, value) in container.attributes">{{attribute}} <a ng-click=deleteAttribute(attribute)>Delete</a></dt><dd ng-repeat-end><pre>{{value | json}}</pre></dd></dl><div class=form__group ng-if="(objectDefinition.attribute_list | filter:showAttribute).length"><button ng-click="prompt(\'newAttribute\')">Add attribute</button></div></fieldset></div><div class=layout__item style=width:50% ng-if="(objectDefinition.sensor_list | filter:showSensor).length || container.sensors"><fieldset><legend>Sensors</legend><modal modal-id=newSensor-{{container.$$hashKey}} ng-if="(objectDefinition.sensor_list | filter:showSensor).length"><form class=form--stacked ng-submit=addSensor()><div class=form__group><label>New sensor</label><select required ng-options="sensor for sensor in objectDefinition.sensor_list | filter:showSensor" ng-model=newSensor.name><option value="">-- Choose sensor --</option></select></div><div class=form__group ng-if=newSensor.name><label>Source</label><select required ng-model=newSensor.file ng-options="file.name for file in files | hasTimestamp"><option value="">-- Choose file --</option></select><select required ng-model=newSensor.column ng-options="key as column for (key, column) in newSensor.file.columns"><option value="">-- Choose column --</option></select></div><div class=form__group ng-if=newSensor.name><label>Value unit</label><select required ng-model=newSensor.unit ng-options="key as unit.value for (key, unit) in units[definition.sensors[newSensor.name].unit_type]"><option value="">-- Choose unit --</option></select></div><button>Add</button> <button type=button ng-click="cancel(\'newSensor\')">Cancel</button></form></modal><dl ng-if=container.sensors.length><dt ng-repeat-start="sensor in container.sensors">{{sensor.name}} <a ng-click=deleteSensor($index)>Delete</a></dt><dd ng-repeat-end>{{sensor.file.name}} &rarr; {{sensor.file.columns[sensor.column]}}<span ng-if=sensor.unit>&nbsp;({{sensor.unit}})</span></dd></dl><div class=form__group ng-if="(objectDefinition.sensor_list | filter:showSensor).length"><button ng-click="prompt(\'newSensor\')">Add sensor</button></div></fieldset></div></div><div class=form__group>Add under {{container.name}}:<span ng-repeat="child in objectDefinition.child_list">&nbsp;<button ng-click=addChild(child)>{{child}}</button></span></div><sensor-container ng-repeat="child in container.children" parent=container container=child files=files></sensor-container></div>'),a.put("shared-analyses.tpl.html",'<div class=container><div class="view view--shared-analysis" ng-if=valid><h1>{{sharedAnalysis.name}}</h1><div class=form__group ng-if=!data><span class="spinner fa fa-circle-o-notch"></span> Loading analysis&hellip;</div><analysis-report ng-repeat="report in sharedAnalysis.reports" ng-if=data ar-report=report ar-data=data></analysis-report></div><p ng-if=!valid>Invalid shared analysis link.</p></div>'),a.put("signup.tpl.html",'<div class=container><div class="view view--signup"><h1>OpenEIS</h1><form class=panel ng-submit=submit()><h2>Get an account</h2><div class=form__group><label for=name>Name</label><input id=name type=text ng-model=account.first_name> <small class="help help--error" ng-if=form.error.data.first_name>{{form.error.data.first_name}}</small></div><div class=form__group><label for=email>Email address</label><input id=email type=email required ng-change="form.error.data.email = false" ng-model=account.email> <small class="help help--error" ng-if=form.error.data.email>{{form.error.data.email}}</small></div><div class=form__group><label for=username>Username</label><input id=username type=text autocomplete=off required ng-change="form.error.data.username = false" ng-model=account.username> <small class="help help--error" ng-if=form.error.data.username>{{form.error.data.username}}</small></div><div class=form__group><label for=password>Password</label><input id=password type=password autocomplete=off required ng-trim=false ng-change="form.error.data.password = false; form.passwordConfirm = false" ng-model=account.password> <small class="help help--error" ng-if=form.error.data.password>{{form.error.data.password}}</small><br><label for=passwordConfirm>Confirm password</label><input id=passwordConfirm type=password autocomplete=off required ng-trim=false ng-change="form.passwordConfirm = false" ng-model=account.passwordConfirm> <small class="help help--error" ng-if=form.passwordConfirm>{{form.passwordConfirm}}</small></div><div class=form__group><button type=submit>Sign up</button></div><div class="alert alert--error" ng-if="form.error.status && form.error.status !== 400">Unknown error occurred. ({{form.error.status}})</div></form></div></div>')}]);